
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="wiseodd">
      
      
        <link rel="canonical" href="https://aleximmer.github.io/Laplace/api_reference/utils/">
      
      
        <link rel="prev" href="../marglik_training/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.46">
    
    
      
        <title>Utilities - laplace-torch</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#laplace.utils" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="laplace-torch" class="md-header__button md-logo" aria-label="laplace-torch" data-md-component="logo">
      
  <img src="../../assets/laplace_logo_inv.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            laplace-torch
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Utilities
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aleximmer/laplace" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    laplace
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="laplace-torch" class="md-nav__button md-logo" aria-label="laplace-torch" data-md-component="logo">
      
  <img src="../../assets/laplace_logo_inv.png" alt="logo">

    </a>
    laplace-torch
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aleximmer/laplace" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    laplace
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devs_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developer's Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../regression_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example: Regression
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../calibration_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example: Calibration
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../calibration_gp_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example: GP Inference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../huggingface_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example: Huggingface LLMs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reward_modeling_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example: Reward Modeling
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../laplace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Laplace Frontend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../enums/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Laplace Options
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../baselaplace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Base Laplace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parametriclaplace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parametric Laplace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functionallaplace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Functional Laplace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lllaplace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Last-Layer Laplace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../subnetlaplace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Subnet Laplace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../curvatures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Curvatures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../marglik_training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Marglik Training Utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Utilities
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Utilities
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.SoDSampler" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SoDSampler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FeatureExtractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FeatureExtractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor(last_layer_name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;last_layer_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor(enable_backprop)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;enable_backprop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor(feature_reduction)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;feature_reduction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.forward" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;forward
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" forward">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.forward(x)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;x
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.forward_with_features" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;forward_with_features
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" forward_with_features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.forward_with_features(x)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;x
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.set_last_layer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;set_last_layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" set_last_layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.set_last_layer(last_layer_name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;last_layer_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.find_last_layer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;find_last_layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" find_last_layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.find_last_layer(x)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;x
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.Kron" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Kron
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Kron">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron(kfacs)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;kfacs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.init_from_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;init_from_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" init_from_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.init_from_model(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.init_from_model(device)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.init_from_model(dtype)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;dtype
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.__add__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__add__
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" __add__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.__add__(other)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;other
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.__mul__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__mul__
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" __mul__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.__mul__(scalar)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;scalar
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.decompose" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;decompose
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" decompose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.decompose(damping)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;damping
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron._bmm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_bmm
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" _bmm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron._bmm(W)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;W
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.bmm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;bmm
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" bmm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.bmm(W)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;W
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.bmm(exponent)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;exponent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.logdet" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;logdet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.diag" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;diag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.to_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;to_matrix
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;KronDecomposed
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" KronDecomposed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed(eigenvectors)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;eigenvectors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed(eigenvalues)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;eigenvalues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed(deltas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;deltas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed(dampen)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;dampen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.__add__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__add__
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" __add__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.__add__(deltas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;deltas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.__mul__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__mul__
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" __mul__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.__mul__(scalar)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;scalar
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.logdet" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;logdet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed._bmm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_bmm
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" _bmm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed._bmm(W)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;W
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed._bmm(exponent)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;exponent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.bmm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;bmm
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" bmm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.bmm(W)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;W
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.bmm(exponent)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;exponent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.diag" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;diag
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" diag">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.diag(exponent)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;exponent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.to_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;to_matrix
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" to_matrix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.to_matrix(exponent)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;exponent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" get_subnet_mask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask.get_subnet_mask(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.RandomSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RandomSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RandomSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RandomSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RandomSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RandomSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RandomSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RandomSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.LargestMagnitudeSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LargestMagnitudeSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" LargestMagnitudeSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestMagnitudeSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestMagnitudeSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestMagnitudeSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestMagnitudeSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestMagnitudeSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LargestVarianceDiagLaplaceSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" LargestVarianceDiagLaplaceSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask(n_params_subnet)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_params_subnet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask(diag_laplace_model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;diag_laplace_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LargestVarianceSWAGSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" LargestVarianceSWAGSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask(n_params_subnet)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_params_subnet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask(likelihood)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;likelihood
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask(swag_n_snapshots)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;swag_n_snapshots
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask(swag_snapshot_freq)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;swag_snapshot_freq
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask(swag_lr)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;swag_lr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ParamNameSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ParamNameSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask(parameter_names)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;parameter_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ModuleNameSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ModuleNameSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask(parameter_names)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;parameter_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LastLayerSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" LastLayerSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask(last_layer_name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;last_layer_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.RunningNLLMetric" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RunningNLLMetric
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RunningNLLMetric">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RunningNLLMetric(ignore_index)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ignore_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RunningNLLMetric.update" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;update
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" update">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RunningNLLMetric.update(probs)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;probs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RunningNLLMetric.update(targets)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;targets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.get_nll" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_nll
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.validate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;validate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.parameters_per_layer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;parameters_per_layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" parameters_per_layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.parameters_per_layer(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.invsqrt_precision" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;invsqrt_precision
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" invsqrt_precision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.invsqrt_precision(M)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;M
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.kron" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;kron
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" kron">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.kron(t1)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;t1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.kron(t2)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;t2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.diagonal_add_scalar" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;diagonal_add_scalar
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" diagonal_add_scalar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.diagonal_add_scalar(X)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;X
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.diagonal_add_scalar(value)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.symeig" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;symeig
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" symeig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.symeig(M)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;M
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.block_diag" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;block_diag
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" block_diag">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.block_diag(blocks)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;blocks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.normal_samples" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;normal_samples
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" normal_samples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.normal_samples(mean)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;mean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.normal_samples(var)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;var
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.normal_samples(generator)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;generator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils._is_batchnorm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;_is_batchnorm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils._is_valid_scalar" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;_is_valid_scalar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.expand_prior_precision" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;expand_prior_precision
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" expand_prior_precision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.expand_prior_precision(prior_prec)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;prior_prec
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.expand_prior_precision(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;fix_prior_prec_structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" fix_prior_prec_structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure(prior_prec_init)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;prior_prec_init
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure(prior_structure)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;prior_structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure(n_layers)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_layers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure(n_params)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure(device)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure(dtype)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;dtype
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;fit_diagonal_swag_var
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" fit_diagonal_swag_var">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(criterion)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;criterion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(n_snapshots_total)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_snapshots_total
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(snapshot_freq)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;snapshot_freq
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(lr)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;lr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(momentum)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;momentum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(weight_decay)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;weight_decay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(min_var)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;min_var
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.SoDSampler" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SoDSampler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;FeatureExtractor
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" FeatureExtractor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor(last_layer_name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;last_layer_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor(enable_backprop)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;enable_backprop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor(feature_reduction)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;feature_reduction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.forward" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;forward
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" forward">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.forward(x)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;x
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.forward_with_features" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;forward_with_features
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" forward_with_features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.forward_with_features(x)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;x
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.set_last_layer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;set_last_layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" set_last_layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.set_last_layer(last_layer_name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;last_layer_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.find_last_layer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;find_last_layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" find_last_layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.FeatureExtractor.find_last_layer(x)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;x
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.Kron" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Kron
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Kron">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron(kfacs)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;kfacs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.init_from_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;init_from_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" init_from_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.init_from_model(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.init_from_model(device)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.init_from_model(dtype)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;dtype
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.__add__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__add__
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" __add__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.__add__(other)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;other
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.__mul__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__mul__
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" __mul__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.__mul__(scalar)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;scalar
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.decompose" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;decompose
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" decompose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.decompose(damping)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;damping
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron._bmm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_bmm
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" _bmm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron._bmm(W)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;W
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.bmm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;bmm
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" bmm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.bmm(W)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;W
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.bmm(exponent)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;exponent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.logdet" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;logdet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.diag" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;diag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.Kron.to_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;to_matrix
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;KronDecomposed
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" KronDecomposed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed(eigenvectors)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;eigenvectors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed(eigenvalues)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;eigenvalues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed(deltas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;deltas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed(dampen)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;dampen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.__add__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__add__
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" __add__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.__add__(deltas)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;deltas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.__mul__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__mul__
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" __mul__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.__mul__(scalar)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;scalar
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.logdet" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;logdet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed._bmm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_bmm
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" _bmm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed._bmm(W)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;W
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed._bmm(exponent)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;exponent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.bmm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;bmm
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" bmm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.bmm(W)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;W
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.bmm(exponent)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;exponent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.diag" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;diag
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" diag">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.diag(exponent)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;exponent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.to_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;to_matrix
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" to_matrix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.KronDecomposed.to_matrix(exponent)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;exponent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" SubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" get_subnet_mask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.SubnetMask.get_subnet_mask(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.RandomSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RandomSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RandomSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RandomSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RandomSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RandomSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RandomSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RandomSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.LargestMagnitudeSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LargestMagnitudeSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" LargestMagnitudeSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestMagnitudeSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestMagnitudeSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestMagnitudeSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestMagnitudeSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestMagnitudeSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LargestVarianceDiagLaplaceSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" LargestVarianceDiagLaplaceSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask(n_params_subnet)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_params_subnet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask(diag_laplace_model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;diag_laplace_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LargestVarianceSWAGSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" LargestVarianceSWAGSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask(n_params_subnet)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_params_subnet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask(likelihood)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;likelihood
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask(swag_n_snapshots)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;swag_n_snapshots
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask(swag_snapshot_freq)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;swag_snapshot_freq
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask(swag_lr)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;swag_lr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LargestVarianceSWAGSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ParamNameSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ParamNameSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask(parameter_names)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;parameter_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ParamNameSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ModuleNameSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ModuleNameSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask(parameter_names)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;parameter_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.ModuleNameSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;LastLayerSubnetMask
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" LastLayerSubnetMask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask(last_layer_name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;last_layer_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask.convert_subnet_mask_to_indices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_subnet_mask_to_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" convert_subnet_mask_to_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask.select" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" select">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask.select(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.LastLayerSubnetMask.get_subnet_mask" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subnet_mask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.RunningNLLMetric" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RunningNLLMetric
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RunningNLLMetric">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RunningNLLMetric(ignore_index)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;ignore_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RunningNLLMetric.update" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;update
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" update">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RunningNLLMetric.update(probs)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;probs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.RunningNLLMetric.update(targets)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;targets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.get_nll" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_nll
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.validate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;validate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.parameters_per_layer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;parameters_per_layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" parameters_per_layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.parameters_per_layer(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.invsqrt_precision" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;invsqrt_precision
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" invsqrt_precision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.invsqrt_precision(M)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;M
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.kron" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;kron
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" kron">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.kron(t1)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;t1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.kron(t2)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;t2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.diagonal_add_scalar" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;diagonal_add_scalar
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" diagonal_add_scalar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.diagonal_add_scalar(X)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;X
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.diagonal_add_scalar(value)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.symeig" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;symeig
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" symeig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.symeig(M)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;M
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.block_diag" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;block_diag
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" block_diag">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.block_diag(blocks)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;blocks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.normal_samples" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;normal_samples
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" normal_samples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.normal_samples(mean)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;mean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.normal_samples(var)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;var
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.normal_samples(generator)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;generator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils._is_batchnorm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;_is_batchnorm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils._is_valid_scalar" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;_is_valid_scalar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.expand_prior_precision" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;expand_prior_precision
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" expand_prior_precision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.expand_prior_precision(prior_prec)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;prior_prec
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.expand_prior_precision(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;fix_prior_prec_structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" fix_prior_prec_structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure(prior_prec_init)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;prior_prec_init
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure(prior_structure)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;prior_structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure(n_layers)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_layers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure(n_params)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure(device)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fix_prior_prec_structure(dtype)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;dtype
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;fit_diagonal_swag_var
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" fit_diagonal_swag_var">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(train_loader)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;train_loader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(criterion)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;criterion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(n_snapshots_total)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;n_snapshots_total
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(snapshot_freq)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;snapshot_freq
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(lr)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;lr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(momentum)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;momentum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(weight_decay)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;weight_decay
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#laplace.utils.fit_diagonal_swag_var(min_var)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;min_var
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<div class="doc doc-object doc-module">



<h1 id="laplace.utils" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">laplace.utils</span>


<a href="#laplace.utils" class="headerlink" title="Permanent link">#</a></h1>

    <div class="doc doc-contents first">







<p><span class="doc-section-title">Classes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="laplace.utils.SoDSampler" href="#laplace.utils.SoDSampler">SoDSampler</a></code></b>
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="laplace.utils.FeatureExtractor" href="#laplace.utils.FeatureExtractor">FeatureExtractor</a></code></b>
          –
          <div class="doc-md-description">
            <p>Feature extractor for a PyTorch neural network.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="laplace.utils.Kron" href="#laplace.utils.Kron">Kron</a></code></b>
          –
          <div class="doc-md-description">
            <p>Kronecker factored approximate curvature representation for a corresponding</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="laplace.utils.KronDecomposed" href="#laplace.utils.KronDecomposed">KronDecomposed</a></code></b>
          –
          <div class="doc-md-description">
            <p>Decomposed Kronecker factored approximate curvature representation</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="laplace.utils.SubnetMask" href="#laplace.utils.SubnetMask">SubnetMask</a></code></b>
          –
          <div class="doc-md-description">
            <p>Baseclass for all subnetwork masks in this library (for subnetwork Laplace).</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="laplace.utils.RandomSubnetMask" href="#laplace.utils.RandomSubnetMask">RandomSubnetMask</a></code></b>
          –
          <div class="doc-md-description">
            <p>Subnetwork mask of parameters sampled uniformly at random.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LargestMagnitudeSubnetMask" href="#laplace.utils.LargestMagnitudeSubnetMask">LargestMagnitudeSubnetMask</a></code></b>
          –
          <div class="doc-md-description">
            <p>Subnetwork mask identifying the parameters with the largest magnitude.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LargestVarianceDiagLaplaceSubnetMask" href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask">LargestVarianceDiagLaplaceSubnetMask</a></code></b>
          –
          <div class="doc-md-description">
            <p>Subnetwork mask identifying the parameters with the largest marginal variances</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LargestVarianceSWAGSubnetMask" href="#laplace.utils.LargestVarianceSWAGSubnetMask">LargestVarianceSWAGSubnetMask</a></code></b>
          –
          <div class="doc-md-description">
            <p>Subnetwork mask identifying the parameters with the largest marginal variances</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="laplace.utils.ParamNameSubnetMask" href="#laplace.utils.ParamNameSubnetMask">ParamNameSubnetMask</a></code></b>
          –
          <div class="doc-md-description">
            <p>Subnetwork mask corresponding to the specified parameters of the neural network.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="laplace.utils.ModuleNameSubnetMask" href="#laplace.utils.ModuleNameSubnetMask">ModuleNameSubnetMask</a></code></b>
          –
          <div class="doc-md-description">
            <p>Subnetwork mask corresponding to the specified modules of the neural network.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LastLayerSubnetMask" href="#laplace.utils.LastLayerSubnetMask">LastLayerSubnetMask</a></code></b>
          –
          <div class="doc-md-description">
            <p>Subnetwork mask corresponding to the last layer of the neural network.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="laplace.utils.RunningNLLMetric" href="#laplace.utils.RunningNLLMetric">RunningNLLMetric</a></code></b>
          –
          <div class="doc-md-description">
            <p>NLL metrics that</p>
          </div>
        </li>
    </ul>




<p><span class="doc-section-title">Functions:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.get_nll" href="#laplace.utils.get_nll">get_nll</a></code></b>
            –
            <div class="doc-md-description">
              
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.validate" href="#laplace.utils.validate">validate</a></code></b>
            –
            <div class="doc-md-description">
              
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.parameters_per_layer" href="#laplace.utils.parameters_per_layer">parameters_per_layer</a></code></b>
            –
            <div class="doc-md-description">
              <p>Get number of parameters per layer.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.invsqrt_precision" href="#laplace.utils.invsqrt_precision">invsqrt_precision</a></code></b>
            –
            <div class="doc-md-description">
              <p>Compute <code>M^{-0.5}</code> as a tridiagonal matrix.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.kron" href="#laplace.utils.kron">kron</a></code></b>
            –
            <div class="doc-md-description">
              <p>Computes the Kronecker product between two tensors.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.diagonal_add_scalar" href="#laplace.utils.diagonal_add_scalar">diagonal_add_scalar</a></code></b>
            –
            <div class="doc-md-description">
              <p>Add scalar value <code>value</code> to diagonal of <code>X</code>.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.symeig" href="#laplace.utils.symeig">symeig</a></code></b>
            –
            <div class="doc-md-description">
              <p>Symetric eigendecomposition avoiding failure cases by</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.block_diag" href="#laplace.utils.block_diag">block_diag</a></code></b>
            –
            <div class="doc-md-description">
              <p>Compose block-diagonal matrix of individual blocks.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.normal_samples" href="#laplace.utils.normal_samples">normal_samples</a></code></b>
            –
            <div class="doc-md-description">
              <p>Produce samples from a batch of Normal distributions either parameterized</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils._is_batchnorm" href="#laplace.utils._is_batchnorm">_is_batchnorm</a></code></b>
            –
            <div class="doc-md-description">
              
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils._is_valid_scalar" href="#laplace.utils._is_valid_scalar">_is_valid_scalar</a></code></b>
            –
            <div class="doc-md-description">
              
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.expand_prior_precision" href="#laplace.utils.expand_prior_precision">expand_prior_precision</a></code></b>
            –
            <div class="doc-md-description">
              <p>Expand prior precision to match the shape of the model parameters.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.fix_prior_prec_structure" href="#laplace.utils.fix_prior_prec_structure">fix_prior_prec_structure</a></code></b>
            –
            <div class="doc-md-description">
              <p>Create a tensor of prior precision with the correct shape, depending on the</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.fit_diagonal_swag_var" href="#laplace.utils.fit_diagonal_swag_var">fit_diagonal_swag_var</a></code></b>
            –
            <div class="doc-md-description">
              <p>Fit diagonal SWAG [1], which estimates marginal variances of model parameters by</p>
            </div>
          </li>
    </ul>





  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="laplace.utils.SoDSampler" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">SoDSampler</span>


<a href="#laplace.utils.SoDSampler" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">SoDSampler</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.utils.data.Sampler">Sampler</span></code></p>











                  <details class="quote">
                    <summary>Source code in <code>laplace/utils/utils.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)),</span> <span class="n">M</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="laplace.utils.FeatureExtractor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">FeatureExtractor</span>


<a href="#laplace.utils.FeatureExtractor" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">FeatureExtractor</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.FeatureExtractor(model)">model</a></span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.FeatureExtractor(last_layer_name)">last_layer_name</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.FeatureExtractor(enable_backprop)">enable_backprop</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.FeatureExtractor(feature_reduction)">feature_reduction</a></span><span class="p">:</span> <span class="n"><span title="laplace.utils.feature_extractor.FeatureReduction">FeatureReduction</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>Feature extractor for a PyTorch neural network.
A wrapper which can return the output of the penultimate layer in addition to
the output of the last layer for each forward pass. If the name of the last
layer is not known, it can determine it automatically. It assumes that the
last layer is linear and that for every forward pass the last layer is the same.
If the name of the last layer is known, it can be passed as a parameter at
initilization; this is the safest way to use this class.
Based on <a href="https://gist.github.com/fkodom/27ed045c9051a39102e8bcf4ce31df76">https://gist.github.com/fkodom/27ed045c9051a39102e8bcf4ce31df76</a>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.FeatureExtractor(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
<a href="#laplace.utils.FeatureExtractor(model)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.nn.Module">Module</span></code>)
          –
          <div class="doc-md-description">
            <p>PyTorch model</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.FeatureExtractor(last_layer_name)" class="doc doc-heading doc-heading-parameter">              <b><code>last_layer_name</code></b>
<a href="#laplace.utils.FeatureExtractor(last_layer_name)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>if the name of the last layer is already known, otherwise it will
be determined automatically.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.FeatureExtractor(enable_backprop)" class="doc doc-heading doc-heading-parameter">              <b><code>enable_backprop</code></b>
<a href="#laplace.utils.FeatureExtractor(enable_backprop)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          –
          <div class="doc-md-description">
            <p>whether to enable backprop through the feature extactor to get the gradients of
the inputs. Useful for e.g. Bayesian optimization.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.FeatureExtractor(feature_reduction)" class="doc doc-heading doc-heading-parameter">              <b><code>feature_reduction</code></b>
<a href="#laplace.utils.FeatureExtractor(feature_reduction)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="laplace.utils.feature_extractor.FeatureReduction">FeatureReduction</span> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>when the last-layer <code>features</code> is a tensor of dim &gt;= 3, this tells how to reduce
it into a dim-2 tensor. E.g. in LLMs for non-language modeling problems,
the penultultimate output is a tensor of shape <code>(batch_size, seq_len, embd_dim)</code>.
But the last layer maps <code>(batch_size, embd_dim)</code> to <code>(batch_size, n_classes)</code>.
Note: Make sure that this option faithfully reflects the reduction in the model
definition. When inputting a string, available options are
<code>{'pick_first', 'pick_last', 'average'}</code>.</p>
          </div>
        </li>
    </ul>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.FeatureExtractor.forward" href="#laplace.utils.FeatureExtractor.forward">forward</a></code></b>
            –
            <div class="doc-md-description">
              <p>Forward pass. If the last layer is not known yet, it will be</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.FeatureExtractor.forward_with_features" href="#laplace.utils.FeatureExtractor.forward_with_features">forward_with_features</a></code></b>
            –
            <div class="doc-md-description">
              <p>Forward pass which returns the output of the penultimate layer along</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.FeatureExtractor.set_last_layer" href="#laplace.utils.FeatureExtractor.set_last_layer">set_last_layer</a></code></b>
            –
            <div class="doc-md-description">
              <p>Set the last layer of the model by its name. This sets the forward</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.FeatureExtractor.find_last_layer" href="#laplace.utils.FeatureExtractor.find_last_layer">find_last_layer</a></code></b>
            –
            <div class="doc-md-description">
              <p>Automatically determines the last layer of the model with one</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>laplace/utils/feature_extractor.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="n">last_layer_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="n">enable_backprop</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="n">feature_reduction</span><span class="p">:</span> <span class="n">FeatureReduction</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">if</span> <span class="n">feature_reduction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">feature_reduction</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="n">fr</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">fr</span> <span class="ow">in</span> <span class="n">FeatureReduction</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="p">]:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>            <span class="s2">&quot;`feature_reduction` must take value in the `FeatureReduction enum` or &quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="s2">&quot;one of `{&#39;pick_first&#39;, &#39;pick_last&#39;, &#39;average&#39;}`!&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="n">model</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_features</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">enable_backprop</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">enable_backprop</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">feature_reduction</span><span class="p">:</span> <span class="n">FeatureReduction</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">feature_reduction</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_layer</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">|</span> <span class="kc">None</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="k">if</span> <span class="n">last_layer_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_layer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_last_layer</span><span class="p">(</span><span class="n">last_layer_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="laplace.utils.FeatureExtractor.forward" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">forward</span>


<a href="#laplace.utils.FeatureExtractor.forward" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">forward</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.FeatureExtractor.forward(x)">x</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.MutableMapping" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.MutableMapping">MutableMapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><span title="torch.Tensor">Tensor</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Forward pass. If the last layer is not known yet, it will be
determined when this function is called for the first time.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.FeatureExtractor.forward(x)" class="doc doc-heading doc-heading-parameter">              <b><code>x</code></b>
<a href="#laplace.utils.FeatureExtractor.forward(x)" class="headerlink" title="Permanent link">#</a></h4>              (<code>torch.Tensor or a dict-like object containing the input tensors</code>)
          –
          <div class="doc-md-description">
            <p>one batch of data to use as input for the forward pass</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/feature_extractor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="n">Any</span><span class="p">]</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Forward pass. If the last layer is not known yet, it will be</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    determined when this function is called for the first time.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    x : torch.Tensor or a dict-like object containing the input tensors</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        one batch of data to use as input for the forward pass</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="c1"># if this is the first forward pass and last layer is unknown</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_last_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="c1"># if last and penultimate layers are already known</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.FeatureExtractor.forward_with_features" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">forward_with_features</span>


<a href="#laplace.utils.FeatureExtractor.forward_with_features" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">forward_with_features</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.FeatureExtractor.forward_with_features(x)">x</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.MutableMapping" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.MutableMapping">MutableMapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><span title="torch.Tensor">Tensor</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a></span><span class="p">[</span><span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Forward pass which returns the output of the penultimate layer along
with the output of the last layer. If the last layer is not known yet,
it will be determined when this function is called for the first time.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.FeatureExtractor.forward_with_features(x)" class="doc doc-heading doc-heading-parameter">              <b><code>x</code></b>
<a href="#laplace.utils.FeatureExtractor.forward_with_features(x)" class="headerlink" title="Permanent link">#</a></h4>              (<code>torch.Tensor or a dict-like object containing the input tensors</code>)
          –
          <div class="doc-md-description">
            <p>one batch of data to use as input for the forward pass</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/feature_extractor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="k">def</span> <span class="nf">forward_with_features</span><span class="p">(</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="n">Any</span><span class="p">]</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Forward pass which returns the output of the penultimate layer along</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    with the output of the last layer. If the last layer is not known yet,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    it will be determined when this function is called for the first time.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    x : torch.Tensor or a dict-like object containing the input tensors</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        one batch of data to use as input for the forward pass</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_features</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_layer_name</span><span class="p">]</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="k">if</span> <span class="n">features</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_reduction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">n_intermediate_dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_reduction</span> <span class="o">==</span> <span class="n">FeatureReduction</span><span class="o">.</span><span class="n">PICK_FIRST</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>                <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="o">*</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_intermediate_dims</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_reduction</span> <span class="o">==</span> <span class="n">FeatureReduction</span><span class="o">.</span><span class="n">PICK_LAST</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="o">*</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_intermediate_dims</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">ndim</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">ndim</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                <span class="n">dim</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="k">return</span> <span class="n">out</span><span class="p">,</span> <span class="n">features</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.FeatureExtractor.set_last_layer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">set_last_layer</span>


<a href="#laplace.utils.FeatureExtractor.set_last_layer" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">set_last_layer</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.FeatureExtractor.set_last_layer(last_layer_name)">last_layer_name</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set the last layer of the model by its name. This sets the forward
hook to get the output of the penultimate layer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.FeatureExtractor.set_last_layer(last_layer_name)" class="doc doc-heading doc-heading-parameter">              <b><code>last_layer_name</code></b>
<a href="#laplace.utils.FeatureExtractor.set_last_layer(last_layer_name)" class="headerlink" title="Permanent link">#</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
          –
          <div class="doc-md-description">
            <p>the name of the last layer (fixed in <code>model.named_modules()</code>).</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/feature_extractor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="k">def</span> <span class="nf">set_last_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_layer_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the last layer of the model by its name. This sets the forward</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    hook to get the output of the penultimate layer.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    last_layer_name : str</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        the name of the last layer (fixed in `model.named_modules()`).</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="c1"># set last_layer attributes and check if it is linear</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_last_layer_name</span> <span class="o">=</span> <span class="n">last_layer_name</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_layer</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">named_modules</span><span class="p">())[</span><span class="n">last_layer_name</span><span class="p">]</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_layer</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">):</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Use model with a linear last layer.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="c1"># set forward hook to extract features in future forward passes</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">last_layer</span><span class="o">.</span><span class="n">register_forward_hook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_hook</span><span class="p">(</span><span class="n">last_layer_name</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.FeatureExtractor.find_last_layer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">find_last_layer</span>


<a href="#laplace.utils.FeatureExtractor.find_last_layer" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">find_last_layer</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.FeatureExtractor.find_last_layer(x)">x</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.MutableMapping" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.MutableMapping">MutableMapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><span title="torch.Tensor">Tensor</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Automatically determines the last layer of the model with one
forward pass. It assumes that the last layer is the same for every
forward pass and that it is an instance of <code>torch.nn.Linear</code>.
Might not work with every architecture, but is tested with all PyTorch
torchvision classification models (besides SqueezeNet, which has no
linear last layer).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.FeatureExtractor.find_last_layer(x)" class="doc doc-heading doc-heading-parameter">              <b><code>x</code></b>
<a href="#laplace.utils.FeatureExtractor.find_last_layer(x)" class="headerlink" title="Permanent link">#</a></h4>              (<code>torch.Tensor or dict-like object containing the input tensors</code>)
          –
          <div class="doc-md-description">
            <p>one batch of data to use as input for the forward pass</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/feature_extractor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="k">def</span> <span class="nf">find_last_layer</span><span class="p">(</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="n">Any</span><span class="p">]</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Automatically determines the last layer of the model with one</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    forward pass. It assumes that the last layer is the same for every</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    forward pass and that it is an instance of `torch.nn.Linear`.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    Might not work with every architecture, but is tested with all PyTorch</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    torchvision classification models (besides SqueezeNet, which has no</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">    linear last layer).</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    x : torch.Tensor or dict-like object containing the input tensors</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        one batch of data to use as input for the forward pass</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_layer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Last layer is already known.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="n">act_out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="k">def</span> <span class="nf">get_act_hook</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="k">def</span> <span class="nf">act_hook</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">__</span><span class="p">):</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="c1"># only accepts one input (expects linear layer)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                <span class="n">act_out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                <span class="n">act_out</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="c1"># remove hook</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="n">handles</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="k">return</span> <span class="n">act_hook</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="c1"># set hooks for all modules</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="n">handles</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">named_modules</span><span class="p">():</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="n">handles</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">register_forward_hook</span><span class="p">(</span><span class="n">get_act_hook</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="c1"># check if model has more than one module</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="c1"># (there might be pathological exceptions)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The model only has one module.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="c1"># forward pass to find execution order</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="c1"># find the last layer, store features, return output of forward pass</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">act_out</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="n">layer</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">named_modules</span><span class="p">())[</span><span class="n">key</span><span class="p">]</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">children</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_last_layer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>            <span class="c1"># save features from first forward pass</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_features</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">act_out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="k">return</span> <span class="n">out</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Something went wrong (all modules have children).&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="laplace.utils.Kron" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">Kron</span>


<a href="#laplace.utils.Kron" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">Kron</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.Kron(kfacs)">kfacs</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a></span><span class="p">[</span><span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">]</span> <span class="o">|</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">])</span>
</code></pre></div>

    <div class="doc doc-contents ">


        <p>Kronecker factored approximate curvature representation for a corresponding
neural network.
Each element in <code>kfacs</code> is either a tuple or single matrix.
A tuple represents two Kronecker factors <span class="arithmatex">\(Q\)</span>, and <span class="arithmatex">\(H\)</span> and a single element
is just a full block Hessian approximation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.Kron(kfacs)" class="doc doc-heading doc-heading-parameter">              <b><code>kfacs</code></b>
<a href="#laplace.utils.Kron(kfacs)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" title="typing.Iterable" href="https://docs.python.org/3/library/typing.html#typing.Iterable">Iterable</a>[<span title="torch.Tensor">Tensor</span>] | <span title="torch.Tensor">Tensor</span>]</code>)
          –
          <div class="doc-md-description">
            <p>each element in the list is a tuple of two Kronecker factors Q, H
or a single matrix approximating the Hessian (in case of bias, for example)</p>
          </div>
        </li>
    </ul>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.Kron.init_from_model" href="#laplace.utils.Kron.init_from_model">init_from_model</a></code></b>
            –
            <div class="doc-md-description">
              <p>Initialize Kronecker factors based on a models architecture.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.Kron.__add__" href="#laplace.utils.Kron.__add__">__add__</a></code></b>
            –
            <div class="doc-md-description">
              <p>Add up Kronecker factors <code>self</code> and <code>other</code>.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.Kron.__mul__" href="#laplace.utils.Kron.__mul__">__mul__</a></code></b>
            –
            <div class="doc-md-description">
              <p>Multiply all Kronecker factors by scalar.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.Kron.decompose" href="#laplace.utils.Kron.decompose">decompose</a></code></b>
            –
            <div class="doc-md-description">
              <p>Eigendecompose Kronecker factors and turn into <code>KronDecomposed</code>.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.Kron.bmm" href="#laplace.utils.Kron.bmm">bmm</a></code></b>
            –
            <div class="doc-md-description">
              <p>Batched matrix multiplication with the Kronecker factors.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.Kron.logdet" href="#laplace.utils.Kron.logdet">logdet</a></code></b>
            –
            <div class="doc-md-description">
              <p>Compute log determinant of the Kronecker factors and sums them up.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.Kron.diag" href="#laplace.utils.Kron.diag">diag</a></code></b>
            –
            <div class="doc-md-description">
              <p>Extract diagonal of the entire Kronecker factorization.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.Kron.to_matrix" href="#laplace.utils.Kron.to_matrix">to_matrix</a></code></b>
            –
            <div class="doc-md-description">
              <p>Make the Kronecker factorization dense by computing the kronecker product.</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kfacs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">kfacs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="n">kfacs</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="laplace.utils.Kron.init_from_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">init_from_model</span>


<a href="#laplace.utils.Kron.init_from_model" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">init_from_model</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.Kron.init_from_model(model)">model</a></span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Iterable" href="https://docs.python.org/3/library/typing.html#typing.Iterable">Iterable</a></span><span class="p">[</span><span class="n"><span title="torch.nn.Parameter">Parameter</span></span><span class="p">],</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.Kron.init_from_model(device)">device</a></span><span class="p">:</span> <span class="n"><span title="torch.device">device</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.Kron.init_from_model(dtype)">dtype</a></span><span class="p">:</span> <span class="n"><span title="torch.dtype">dtype</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.matrix.Kron" href="#laplace.utils.Kron">Kron</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize Kronecker factors based on a models architecture.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.Kron.init_from_model(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
<a href="#laplace.utils.Kron.init_from_model(model)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.nn.Module">Module</span> | <a class="autorefs autorefs-external" title="typing.Iterable" href="https://docs.python.org/3/library/typing.html#typing.Iterable">Iterable</a>[<span title="torch.nn.Parameter">Parameter</span>]</code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.Kron.init_from_model(device)" class="doc doc-heading doc-heading-parameter">              <b><code>device</code></b>
<a href="#laplace.utils.Kron.init_from_model(device)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.device">device</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.Kron.init_from_model(dtype)" class="doc doc-heading doc-heading-parameter">              <b><code>dtype</code></b>
<a href="#laplace.utils.Kron.init_from_model(dtype)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.dtype">dtype</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>kron</code></b> (              <code><a class="autorefs autorefs-internal" title="laplace.utils.matrix.Kron" href="#laplace.utils.Kron">Kron</a></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="k">def</span> <span class="nf">init_from_model</span><span class="p">(</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="bp">cls</span><span class="p">,</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">],</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Kron</span><span class="p">:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize Kronecker factors based on a models architecture.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    model: `nn.Module` or iterable of parameters, e.g. `model.parameters()`</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    device: The device where each of the Kronecker factor lives in.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    dtype: The data type of each Kronecker factor.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    -------</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    kron : Kron</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">()</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">model</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="n">kfacs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># bias</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="n">P</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="n">kfacs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)])</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="k">elif</span> <span class="mi">4</span> <span class="o">&gt;=</span> <span class="n">p</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># fully connected or conv</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># fully connected</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="n">P_in</span><span class="p">,</span> <span class="n">P_out</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="n">P_in</span><span class="p">,</span> <span class="n">P_out</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="n">kfacs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                <span class="p">[</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">P_in</span><span class="p">,</span> <span class="n">P_in</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">),</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">P_out</span><span class="p">,</span> <span class="n">P_out</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">),</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>                <span class="p">]</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid parameter shape in network.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">kfacs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.Kron.__add__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__add__</span>


<a href="#laplace.utils.Kron.__add__" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="fm">__add__</span><span class="p">(</span><span class="nf"><a class="autorefs autorefs-internal" href="#laplace.utils.Kron.__add__(other)">other</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.matrix.Kron" href="#laplace.utils.Kron">Kron</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.matrix.Kron" href="#laplace.utils.Kron">Kron</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add up Kronecker factors <code>self</code> and <code>other</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.Kron.__add__(other)" class="doc doc-heading doc-heading-parameter">              <b><code>other</code></b>
<a href="#laplace.utils.Kron.__add__(other)" class="headerlink" title="Permanent link">#</a></h4>              (<code><a class="autorefs autorefs-internal" title="laplace.utils.matrix.Kron" href="#laplace.utils.Kron">Kron</a></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>kron</code></b> (              <code><a class="autorefs autorefs-internal" title="laplace.utils.matrix.Kron" href="#laplace.utils.Kron">Kron</a></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span>
<span class="normal"><a href="#__codelineno-0-98">98</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Kron</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Kron</span><span class="p">:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add up Kronecker factors `self` and `other`.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    other : Kron</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    -------</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    kron : Kron</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Kron</span><span class="p">):</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can only add Kron to Kron.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="n">kfacs</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="p">[</span><span class="n">Hi</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Hj</span><span class="p">)</span> <span class="k">for</span> <span class="n">Hi</span><span class="p">,</span> <span class="n">Hj</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Fi</span><span class="p">,</span> <span class="n">Fj</span><span class="p">)]</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">for</span> <span class="n">Fi</span><span class="p">,</span> <span class="n">Fj</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kfacs</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">kfacs</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="p">]</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="k">return</span> <span class="n">Kron</span><span class="p">(</span><span class="n">kfacs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.Kron.__mul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__mul__</span>


<a href="#laplace.utils.Kron.__mul__" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="fm">__mul__</span><span class="p">(</span><span class="nf"><a class="autorefs autorefs-internal" href="#laplace.utils.Kron.__mul__(scalar)">scalar</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">|</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.matrix.Kron" href="#laplace.utils.Kron">Kron</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Multiply all Kronecker factors by scalar.
The multiplication is distributed across the number of factors
using <code>pow(scalar, 1 / len(F))</code>. <code>len(F)</code> is either <code>1</code> or <code>2</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.Kron.__mul__(scalar)" class="doc doc-heading doc-heading-parameter">              <b><code>scalar</code></b>
<a href="#laplace.utils.Kron.__mul__(scalar)" class="headerlink" title="Permanent link">#</a></h4>              (<code>(<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>, <span title="torch.Tensor">Tensor</span>)</code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>kron</code></b> (              <code><a class="autorefs autorefs-internal" title="laplace.utils.matrix.Kron" href="#laplace.utils.Kron">Kron</a></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Kron</span><span class="p">:</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply all Kronecker factors by scalar.</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    The multiplication is distributed across the number of factors</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    using `pow(scalar, 1 / len(F))`. `len(F)` is either `1` or `2`.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    scalar : float, torch.Tensor</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    -------</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    kron : Kron</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_valid_scalar</span><span class="p">(</span><span class="n">scalar</span><span class="p">):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input not valid python or torch scalar.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="c1"># distribute factors evenly so that each group is multiplied by factor</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="n">kfacs</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">pow</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">F</span><span class="p">))</span> <span class="o">*</span> <span class="n">Hi</span> <span class="k">for</span> <span class="n">Hi</span> <span class="ow">in</span> <span class="n">F</span><span class="p">]</span> <span class="k">for</span> <span class="n">F</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfacs</span><span class="p">]</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">return</span> <span class="n">Kron</span><span class="p">(</span><span class="n">kfacs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.Kron.decompose" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">decompose</span>


<a href="#laplace.utils.Kron.decompose" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">decompose</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.Kron.decompose(damping)">damping</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.matrix.KronDecomposed" href="#laplace.utils.KronDecomposed">KronDecomposed</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Eigendecompose Kronecker factors and turn into <code>KronDecomposed</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.Kron.decompose(damping)" class="doc doc-heading doc-heading-parameter">              <b><code>damping</code></b>
<a href="#laplace.utils.Kron.decompose(damping)" class="headerlink" title="Permanent link">#</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          –
          <div class="doc-md-description">
            <p>use damping</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>kron_decomposed</code></b> (              <code><a class="autorefs autorefs-internal" title="laplace.utils.matrix.KronDecomposed" href="#laplace.utils.KronDecomposed">KronDecomposed</a></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="k">def</span> <span class="nf">decompose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">damping</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KronDecomposed</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Eigendecompose Kronecker factors and turn into `KronDecomposed`.</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    damping : bool</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        use damping</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    -------</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    kron_decomposed : KronDecomposed</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">eigvecs</span><span class="p">,</span> <span class="n">eigvals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">for</span> <span class="n">F</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfacs</span><span class="p">:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="n">Qs</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">for</span> <span class="n">Hi</span> <span class="ow">in</span> <span class="n">F</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">if</span> <span class="n">Hi</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>                <span class="c1"># Dense Kronecker factor.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>                <span class="n">eigval</span><span class="p">,</span> <span class="n">Q</span> <span class="o">=</span> <span class="n">symeig</span><span class="p">(</span><span class="n">Hi</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="c1"># Diagonal Kronecker factor.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="n">eigval</span> <span class="o">=</span> <span class="n">Hi</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="c1"># This might be too memory intensive since len(Hi) can be large.</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="n">Q</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Hi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Hi</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">Hi</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="n">Qs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="n">ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eigval</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">eigvecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Qs</span><span class="p">)</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">eigvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">return</span> <span class="n">KronDecomposed</span><span class="p">(</span><span class="n">eigvecs</span><span class="p">,</span> <span class="n">eigvals</span><span class="p">,</span> <span class="n">damping</span><span class="o">=</span><span class="n">damping</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.Kron._bmm" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">_bmm</span>


<a href="#laplace.utils.Kron._bmm" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">_bmm</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.Kron._bmm(W)">W</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Implementation of <code>bmm</code> which casts the parameters to the right shape.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.Kron._bmm(W)" class="doc doc-heading doc-heading-parameter">              <b><code>W</code></b>
<a href="#laplace.utils.Kron._bmm(W)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>matrix <code>(batch, classes, params)</code></p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>SW</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>result <code>(batch, classes, params)</code></p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="k">def</span> <span class="nf">_bmm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementation of `bmm` which casts the parameters to the right shape.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    W : torch.Tensor</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        matrix `(batch, classes, params)`</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    -------</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    SW : torch.Tensor</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        result `(batch, classes, params)`</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="c1"># self @ W[batch, k, params]</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">size</span><span class="p">())</span> <span class="o">==</span> <span class="mi">3</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="n">B</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="n">W</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span> <span class="o">*</span> <span class="n">K</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">cur_p</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="n">SW</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="k">for</span> <span class="n">Fs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfacs</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Fs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="n">Q</span> <span class="o">=</span> <span class="n">Fs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="n">W_p</span> <span class="o">=</span> <span class="n">W</span><span class="p">[:,</span> <span class="n">cur_p</span> <span class="p">:</span> <span class="n">cur_p</span> <span class="o">+</span> <span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="n">SW</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Q</span> <span class="o">@</span> <span class="n">W_p</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="k">if</span> <span class="n">Q</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="n">Q</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">W_p</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="n">cur_p</span> <span class="o">+=</span> <span class="n">p</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">Fs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="n">Q</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">Fs</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="n">p_in</span><span class="p">,</span> <span class="n">p_out</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Q</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="n">p</span> <span class="o">=</span> <span class="n">p_in</span> <span class="o">*</span> <span class="n">p_out</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="n">W_p</span> <span class="o">=</span> <span class="n">W</span><span class="p">[:,</span> <span class="n">cur_p</span> <span class="p">:</span> <span class="n">cur_p</span> <span class="o">+</span> <span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span> <span class="o">*</span> <span class="n">K</span><span class="p">,</span> <span class="n">p_in</span><span class="p">,</span> <span class="n">p_out</span><span class="p">)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="n">QW_p</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">@</span> <span class="n">W_p</span> <span class="k">if</span> <span class="n">Q</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">Q</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">W_p</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="n">QW_pHt</span> <span class="o">=</span> <span class="n">QW_p</span> <span class="o">@</span> <span class="n">H</span><span class="o">.</span><span class="n">T</span> <span class="k">if</span> <span class="n">H</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">QW_p</span> <span class="o">*</span> <span class="n">H</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="n">SW</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QW_pHt</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span> <span class="o">*</span> <span class="n">K</span><span class="p">,</span> <span class="n">p_in</span> <span class="o">*</span> <span class="n">p_out</span><span class="p">))</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="n">cur_p</span> <span class="o">+=</span> <span class="n">p</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Shape mismatch&quot;</span><span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="n">SW</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">SW</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">return</span> <span class="n">SW</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.Kron.bmm" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">bmm</span>


<a href="#laplace.utils.Kron.bmm" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">bmm</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.Kron.bmm(W)">W</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.Kron.bmm(exponent)">exponent</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Batched matrix multiplication with the Kronecker factors.
If Kron is <code>H</code>, we compute <code>H @ W</code>.
This is useful for computing the predictive or a regularization
based on Kronecker factors as in continual learning.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.Kron.bmm(W)" class="doc doc-heading doc-heading-parameter">              <b><code>W</code></b>
<a href="#laplace.utils.Kron.bmm(W)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>matrix <code>(batch, classes, params)</code></p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.Kron.bmm(exponent)" class="doc doc-heading doc-heading-parameter">              <b><code>exponent</code></b>
<a href="#laplace.utils.Kron.bmm(exponent)" class="headerlink" title="Permanent link">#</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>1</code>
)
          –
          <div class="doc-md-description">
            <p>only can be <code>1</code> for Kron, requires <code>KronDecomposed</code> for other
exponent values of the Kronecker factors.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>SW</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>result <code>(batch, classes, params)</code></p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="k">def</span> <span class="nf">bmm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">exponent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Batched matrix multiplication with the Kronecker factors.</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    If Kron is `H`, we compute `H @ W`.</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    This is useful for computing the predictive or a regularization</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    based on Kronecker factors as in continual learning.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    W : torch.Tensor</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        matrix `(batch, classes, params)`</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    exponent: float, default=1</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        only can be `1` for Kron, requires `KronDecomposed` for other</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        exponent values of the Kronecker factors.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    -------</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    SW : torch.Tensor</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        result `(batch, classes, params)`</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="k">if</span> <span class="n">exponent</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only supported after decomposition.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="k">if</span> <span class="n">W</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bmm</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="k">elif</span> <span class="n">W</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bmm</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="k">elif</span> <span class="n">W</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bmm</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid shape for W&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.Kron.logdet" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">logdet</span>


<a href="#laplace.utils.Kron.logdet" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">logdet</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute log determinant of the Kronecker factors and sums them up.
This corresponds to the log determinant of the entire Hessian approximation.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>logdet</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="k">def</span> <span class="nf">logdet</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute log determinant of the Kronecker factors and sums them up.</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    This corresponds to the log determinant of the entire Hessian approximation.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    -------</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    logdet : torch.Tensor</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="n">logdet</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="k">for</span> <span class="n">F</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfacs</span><span class="p">:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="n">logdet</span> <span class="o">+=</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">logdet</span><span class="p">()</span> <span class="k">if</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">log</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># len(F) == 2</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="n">Hi</span><span class="p">,</span> <span class="n">Hj</span> <span class="o">=</span> <span class="n">F</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>            <span class="n">p_in</span><span class="p">,</span> <span class="n">p_out</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Hi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Hj</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="n">logdet</span> <span class="o">+=</span> <span class="n">p_out</span> <span class="o">*</span> <span class="n">Hi</span><span class="o">.</span><span class="n">logdet</span><span class="p">()</span> <span class="k">if</span> <span class="n">Hi</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">p_out</span> <span class="o">*</span> <span class="n">Hi</span><span class="o">.</span><span class="n">log</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="n">logdet</span> <span class="o">+=</span> <span class="n">p_in</span> <span class="o">*</span> <span class="n">Hj</span><span class="o">.</span><span class="n">logdet</span><span class="p">()</span> <span class="k">if</span> <span class="n">Hj</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">p_in</span> <span class="o">*</span> <span class="n">Hj</span><span class="o">.</span><span class="n">log</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="k">return</span> <span class="n">logdet</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.Kron.diag" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">diag</span>


<a href="#laplace.utils.Kron.diag" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">diag</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract diagonal of the entire Kronecker factorization.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>diag</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="k">def</span> <span class="nf">diag</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract diagonal of the entire Kronecker factorization.</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    -------</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    diag : torch.Tensor</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="n">diags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="k">for</span> <span class="n">F</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfacs</span><span class="p">:</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">F0</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">diag</span><span class="p">()</span> <span class="k">if</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="n">diags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F0</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="n">F1</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">diag</span><span class="p">()</span> <span class="k">if</span> <span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="n">diags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">F0</span><span class="p">,</span> <span class="n">F1</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">diags</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.Kron.to_matrix" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">to_matrix</span>


<a href="#laplace.utils.Kron.to_matrix" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">to_matrix</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Make the Kronecker factorization dense by computing the kronecker product.
Warning: this should only be used for testing purposes as it will allocate
large amounts of memory for big architectures.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>block_diag</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="k">def</span> <span class="nf">to_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Make the Kronecker factorization dense by computing the kronecker product.</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">    Warning: this should only be used for testing purposes as it will allocate</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">    large amounts of memory for big architectures.</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">    -------</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">    block_diag : torch.Tensor</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="n">blocks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="k">for</span> <span class="n">F</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kfacs</span><span class="p">:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="n">F0</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">diag</span><span class="p">()</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F0</span><span class="p">)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="n">F1</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">diag</span><span class="p">()</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kron</span><span class="p">(</span><span class="n">F0</span><span class="p">,</span> <span class="n">F1</span><span class="p">))</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="k">return</span> <span class="n">block_diag</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="laplace.utils.KronDecomposed" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">KronDecomposed</span>


<a href="#laplace.utils.KronDecomposed" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">KronDecomposed</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.KronDecomposed(eigenvectors)">eigenvectors</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a></span><span class="p">[</span><span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">]],</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.KronDecomposed(eigenvalues)">eigenvalues</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a></span><span class="p">[</span><span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">]],</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.KronDecomposed(deltas)">deltas</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">damping</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


        <p>Decomposed Kronecker factored approximate curvature representation
for a corresponding neural network.
Each matrix in <code>Kron</code> is decomposed to obtain <code>KronDecomposed</code>.
Front-loading decomposition allows cheap repeated computation
of inverses and log determinants.
In contrast to <code>Kron</code>, we can add scalar or layerwise scalars but
we cannot add other <code>Kron</code> or <code>KronDecomposed</code> anymore.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.KronDecomposed(eigenvectors)" class="doc doc-heading doc-heading-parameter">              <b><code>eigenvectors</code></b>
<a href="#laplace.utils.KronDecomposed(eigenvectors)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[Tuple[<span title="torch.Tensor">Tensor</span>]]</code>)
          –
          <div class="doc-md-description">
            <p>eigenvectors corresponding to matrices in a corresponding <code>Kron</code></p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.KronDecomposed(eigenvalues)" class="doc doc-heading doc-heading-parameter">              <b><code>eigenvalues</code></b>
<a href="#laplace.utils.KronDecomposed(eigenvalues)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[Tuple[<span title="torch.Tensor">Tensor</span>]]</code>)
          –
          <div class="doc-md-description">
            <p>eigenvalues corresponding to matrices in a corresponding <code>Kron</code></p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.KronDecomposed(deltas)" class="doc doc-heading doc-heading-parameter">              <b><code>deltas</code></b>
<a href="#laplace.utils.KronDecomposed(deltas)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.Tensor">Tensor</span></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>addend for each group of Kronecker factors representing, for example,
a prior precision</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.KronDecomposed(dampen)" class="doc doc-heading doc-heading-parameter">              <b><code>dampen</code></b>
<a href="#laplace.utils.KronDecomposed(dampen)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          –
          <div class="doc-md-description">
            <p>use dampen approximation mixing prior and Kron partially multiplicatively</p>
          </div>
        </li>
    </ul>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.KronDecomposed.__add__" href="#laplace.utils.KronDecomposed.__add__">__add__</a></code></b>
            –
            <div class="doc-md-description">
              <p>Add scalar per layer or only scalar to Kronecker factors.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.KronDecomposed.__mul__" href="#laplace.utils.KronDecomposed.__mul__">__mul__</a></code></b>
            –
            <div class="doc-md-description">
              <p>Multiply by a scalar by changing the eigenvalues.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.KronDecomposed.logdet" href="#laplace.utils.KronDecomposed.logdet">logdet</a></code></b>
            –
            <div class="doc-md-description">
              <p>Compute log determinant of the Kronecker factors and sums them up.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.KronDecomposed.bmm" href="#laplace.utils.KronDecomposed.bmm">bmm</a></code></b>
            –
            <div class="doc-md-description">
              <p>Batched matrix multiplication with the decomposed Kronecker factors.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.KronDecomposed.diag" href="#laplace.utils.KronDecomposed.diag">diag</a></code></b>
            –
            <div class="doc-md-description">
              <p>Extract diagonal of the entire decomposed Kronecker factorization.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.KronDecomposed.to_matrix" href="#laplace.utils.KronDecomposed.to_matrix">to_matrix</a></code></b>
            –
            <div class="doc-md-description">
              <p>Make the Kronecker factorization dense by computing the kronecker product.</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>    <span class="n">eigenvectors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]],</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="n">eigenvalues</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]],</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="n">deltas</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="n">damping</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="p">):</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span> <span class="o">=</span> <span class="n">eigenvectors</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span> <span class="o">=</span> <span class="n">eigenvalues</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">eigenvectors</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">eigenvectors</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="k">if</span> <span class="n">deltas</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="p">)</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_deltas</span><span class="p">(</span><span class="n">deltas</span><span class="p">)</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="n">deltas</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">damping</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">damping</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="laplace.utils.KronDecomposed.__add__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__add__</span>


<a href="#laplace.utils.KronDecomposed.__add__" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="fm">__add__</span><span class="p">(</span><span class="nf"><a class="autorefs autorefs-internal" href="#laplace.utils.KronDecomposed.__add__(deltas)">deltas</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.matrix.KronDecomposed" href="#laplace.utils.KronDecomposed">KronDecomposed</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add scalar per layer or only scalar to Kronecker factors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.KronDecomposed.__add__(deltas)" class="doc doc-heading doc-heading-parameter">              <b><code>deltas</code></b>
<a href="#laplace.utils.KronDecomposed.__add__(deltas)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>either same length as <code>eigenvalues</code> or scalar.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>kron</code></b> (              <code><a class="autorefs autorefs-internal" title="laplace.utils.matrix.KronDecomposed" href="#laplace.utils.KronDecomposed">KronDecomposed</a></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deltas</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KronDecomposed</span><span class="p">:</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add scalar per layer or only scalar to Kronecker factors.</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">    deltas : torch.Tensor</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        either same length as `eigenvalues` or scalar.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">    -------</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">    kron : KronDecomposed</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_deltas</span><span class="p">(</span><span class="n">deltas</span><span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>    <span class="k">return</span> <span class="n">KronDecomposed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span> <span class="o">+</span> <span class="n">deltas</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.KronDecomposed.__mul__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__mul__</span>


<a href="#laplace.utils.KronDecomposed.__mul__" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="fm">__mul__</span><span class="p">(</span><span class="nf"><a class="autorefs autorefs-internal" href="#laplace.utils.KronDecomposed.__mul__(scalar)">scalar</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.matrix.KronDecomposed" href="#laplace.utils.KronDecomposed">KronDecomposed</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Multiply by a scalar by changing the eigenvalues.
Same as for the case of <code>Kron</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.KronDecomposed.__mul__(scalar)" class="doc doc-heading doc-heading-parameter">              <b><code>scalar</code></b>
<a href="#laplace.utils.KronDecomposed.__mul__(scalar)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span> or <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>kron</code></b> (              <code><a class="autorefs autorefs-internal" title="laplace.utils.matrix.KronDecomposed" href="#laplace.utils.KronDecomposed">KronDecomposed</a></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KronDecomposed</span><span class="p">:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply by a scalar by changing the eigenvalues.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">    Same as for the case of `Kron`.</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">    scalar : torch.Tensor or float</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">    -------</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">    kron : KronDecomposed</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_valid_scalar</span><span class="p">(</span><span class="n">scalar</span><span class="p">):</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid argument, can only multiply Kron with scalar.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="n">eigenvalues</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="p">[</span><span class="nb">pow</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">))</span> <span class="o">*</span> <span class="n">eigval</span> <span class="k">for</span> <span class="n">eigval</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">]</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="k">for</span> <span class="n">ls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="p">]</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="k">return</span> <span class="n">KronDecomposed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span><span class="p">,</span> <span class="n">eigenvalues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.KronDecomposed.logdet" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">logdet</span>


<a href="#laplace.utils.KronDecomposed.logdet" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">logdet</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute log determinant of the Kronecker factors and sums them up.
This corresponds to the log determinant of the entire Hessian approximation.
In contrast to <code>Kron.logdet()</code>, additive <code>deltas</code> corresponding to prior
precisions are added.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>logdet</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="k">def</span> <span class="nf">logdet</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute log determinant of the Kronecker factors and sums them up.</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">    This corresponds to the log determinant of the entire Hessian approximation.</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">    In contrast to `Kron.logdet()`, additive `deltas` corresponding to prior</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">    precisions are added.</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">    -------</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">    logdet : torch.Tensor</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="n">logdet</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="k">for</span> <span class="n">ls</span><span class="p">,</span> <span class="n">delta</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">):</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># not KFAC just full</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>            <span class="n">logdet</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="n">ls</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping</span><span class="p">:</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                <span class="n">l1d</span><span class="p">,</span> <span class="n">l2d</span> <span class="o">=</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">),</span> <span class="n">l2</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                <span class="n">logdet</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">l1d</span><span class="p">,</span> <span class="n">l2d</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                <span class="n">logdet</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">)</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Too many Kronecker factors. Something went wrong.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="k">return</span> <span class="n">logdet</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.KronDecomposed._bmm" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">_bmm</span>


<a href="#laplace.utils.KronDecomposed._bmm" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">_bmm</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.KronDecomposed._bmm(W)">W</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.KronDecomposed._bmm(exponent)">exponent</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Implementation of <code>bmm</code>, i.e., <code>self ** exponent @ W</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.KronDecomposed._bmm(W)" class="doc doc-heading doc-heading-parameter">              <b><code>W</code></b>
<a href="#laplace.utils.KronDecomposed._bmm(W)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>matrix <code>(batch, classes, params)</code></p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.KronDecomposed._bmm(exponent)" class="doc doc-heading doc-heading-parameter">              <b><code>exponent</code></b>
<a href="#laplace.utils.KronDecomposed._bmm(exponent)" class="headerlink" title="Permanent link">#</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>-1</code>
)
          –
          <div class="doc-md-description">
            <p>exponent on <code>self</code></p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>SW</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>result <code>(batch, classes, params)</code></p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="k">def</span> <span class="nf">_bmm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">exponent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementation of `bmm`, i.e., `self ** exponent @ W`.</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">    W : torch.Tensor</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">        matrix `(batch, classes, params)`</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">    exponent : float</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">        exponent on `self`</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">    -------</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">    SW : torch.Tensor</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">        result `(batch, classes, params)`</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="c1"># self @ W[batch, k, params]</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">size</span><span class="p">())</span> <span class="o">==</span> <span class="mi">3</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="n">B</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="n">W</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span> <span class="o">*</span> <span class="n">K</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="n">cur_p</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="n">SW</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">Qs</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>        <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">)</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="p">):</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>            <span class="n">Q</span><span class="p">,</span> <span class="n">eigval</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Qs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="n">ldelta_exp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">eigval</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="n">W_p</span> <span class="o">=</span> <span class="n">W</span><span class="p">[:,</span> <span class="n">cur_p</span> <span class="p">:</span> <span class="n">cur_p</span> <span class="o">+</span> <span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>            <span class="n">SW</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Q</span> <span class="o">@</span> <span class="p">(</span><span class="n">ldelta_exp</span> <span class="o">*</span> <span class="p">(</span><span class="n">Q</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">W_p</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>            <span class="n">cur_p</span> <span class="o">+=</span> <span class="n">p</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>            <span class="n">Q1</span><span class="p">,</span> <span class="n">Q2</span> <span class="o">=</span> <span class="n">Qs</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="n">ls</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping</span><span class="p">:</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>                <span class="n">l1d</span><span class="p">,</span> <span class="n">l2d</span> <span class="o">=</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">),</span> <span class="n">l2</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                <span class="n">ldelta_exp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">l1d</span><span class="p">,</span> <span class="n">l2d</span><span class="p">),</span> <span class="n">exponent</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                <span class="n">ldelta_exp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">)</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">exponent</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>                <span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="n">p_in</span><span class="p">,</span> <span class="n">p_out</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="n">W_p</span> <span class="o">=</span> <span class="n">W</span><span class="p">[:,</span> <span class="n">cur_p</span> <span class="p">:</span> <span class="n">cur_p</span> <span class="o">+</span> <span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span> <span class="o">*</span> <span class="n">K</span><span class="p">,</span> <span class="n">p_in</span><span class="p">,</span> <span class="n">p_out</span><span class="p">)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>            <span class="n">W_p</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q1</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">W_p</span> <span class="o">@</span> <span class="n">Q2</span><span class="p">)</span> <span class="o">*</span> <span class="n">ldelta_exp</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>            <span class="n">W_p</span> <span class="o">=</span> <span class="n">Q1</span> <span class="o">@</span> <span class="n">W_p</span> <span class="o">@</span> <span class="n">Q2</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="n">SW</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">W_p</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span> <span class="o">*</span> <span class="n">K</span><span class="p">,</span> <span class="n">p_in</span> <span class="o">*</span> <span class="n">p_out</span><span class="p">))</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="n">cur_p</span> <span class="o">+=</span> <span class="n">p</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Shape mismatch&quot;</span><span class="p">)</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>    <span class="n">SW</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">SW</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="k">return</span> <span class="n">SW</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.KronDecomposed.bmm" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">bmm</span>


<a href="#laplace.utils.KronDecomposed.bmm" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">bmm</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.KronDecomposed.bmm(W)">W</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.KronDecomposed.bmm(exponent)">exponent</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Batched matrix multiplication with the decomposed Kronecker factors.
This is useful for computing the predictive or a regularization loss.
Compared to <code>Kron.bmm</code>, a prior can be added here in form of <code>deltas</code>
and the exponent can be other than just 1.
Computes <span class="arithmatex">\(H^{exponent} W\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.KronDecomposed.bmm(W)" class="doc doc-heading doc-heading-parameter">              <b><code>W</code></b>
<a href="#laplace.utils.KronDecomposed.bmm(W)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>matrix <code>(batch, classes, params)</code></p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.KronDecomposed.bmm(exponent)" class="doc doc-heading doc-heading-parameter">              <b><code>exponent</code></b>
<a href="#laplace.utils.KronDecomposed.bmm(exponent)" class="headerlink" title="Permanent link">#</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>-1</code>
)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>SW</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>result <code>(batch, classes, params)</code></p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="k">def</span> <span class="nf">bmm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">exponent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Batched matrix multiplication with the decomposed Kronecker factors.</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    This is useful for computing the predictive or a regularization loss.</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    Compared to `Kron.bmm`, a prior can be added here in form of `deltas`</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    and the exponent can be other than just 1.</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">    Computes \\(H^{exponent} W\\).</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">    W : torch.Tensor</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">        matrix `(batch, classes, params)`</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">    exponent: float, default=1</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">    -------</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">    SW : torch.Tensor</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">        result `(batch, classes, params)`</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>    <span class="k">if</span> <span class="n">W</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bmm</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">exponent</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>    <span class="k">elif</span> <span class="n">W</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bmm</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">exponent</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="k">elif</span> <span class="n">W</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bmm</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid shape for W&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.KronDecomposed.diag" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">diag</span>


<a href="#laplace.utils.KronDecomposed.diag" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">diag</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.KronDecomposed.diag(exponent)">exponent</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract diagonal of the entire decomposed Kronecker factorization.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.KronDecomposed.diag(exponent)" class="doc doc-heading doc-heading-parameter">              <b><code>exponent</code></b>
<a href="#laplace.utils.KronDecomposed.diag(exponent)" class="headerlink" title="Permanent link">#</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>1</code>
)
          –
          <div class="doc-md-description">
            <p>exponent of the Kronecker factorization</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>diag</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="k">def</span> <span class="nf">diag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exponent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract diagonal of the entire decomposed Kronecker factorization.</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">    exponent: float, default=1</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">        exponent of the Kronecker factorization</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="sd">    -------</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">    diag : torch.Tensor</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>    <span class="n">diags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>    <span class="k">for</span> <span class="n">Qs</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">delta</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">):</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>            <span class="n">Ql</span> <span class="o">=</span> <span class="n">Qs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                <span class="s2">&quot;mp,mp-&gt;m&quot;</span><span class="p">,</span> <span class="n">Ql</span><span class="p">,</span> <span class="n">Qs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>            <span class="p">)</span>  <span class="c1"># only compute inner products for diag</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>            <span class="n">diags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>            <span class="n">Q1</span><span class="p">,</span> <span class="n">Q2</span> <span class="o">=</span> <span class="n">Qs</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="n">ls</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping</span><span class="p">:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                <span class="n">delta_sqrt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                <span class="n">eigval</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">l1</span> <span class="o">+</span> <span class="n">delta_sqrt</span><span class="p">,</span> <span class="n">l2</span> <span class="o">+</span> <span class="n">delta_sqrt</span><span class="p">),</span> <span class="n">exponent</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>                <span class="p">)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                <span class="n">eigval</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">)</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="s2">&quot;mp,nq,pq,mp,nq-&gt;mn&quot;</span><span class="p">,</span> <span class="n">Q1</span><span class="p">,</span> <span class="n">Q2</span><span class="p">,</span> <span class="n">eigval</span><span class="p">,</span> <span class="n">Q1</span><span class="p">,</span> <span class="n">Q2</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>            <span class="n">diags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">diags</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.KronDecomposed.to_matrix" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">to_matrix</span>


<a href="#laplace.utils.KronDecomposed.to_matrix" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">to_matrix</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.KronDecomposed.to_matrix(exponent)">exponent</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Make the Kronecker factorization dense by computing the kronecker product.
Warning: this should only be used for testing purposes as it will allocate
large amounts of memory for big architectures.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.KronDecomposed.to_matrix(exponent)" class="doc doc-heading doc-heading-parameter">              <b><code>exponent</code></b>
<a href="#laplace.utils.KronDecomposed.to_matrix(exponent)" class="headerlink" title="Permanent link">#</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>1</code>
)
          –
          <div class="doc-md-description">
            <p>exponent of the Kronecker factorization</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>block_diag</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/matrix.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="k">def</span> <span class="nf">to_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exponent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Make the Kronecker factorization dense by computing the kronecker product.</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">    Warning: this should only be used for testing purposes as it will allocate</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">    large amounts of memory for big architectures.</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">    exponent: float, default=1</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">        exponent of the Kronecker factorization</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">    -------</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">    block_diag : torch.Tensor</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>    <span class="n">blocks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="k">for</span> <span class="n">Qs</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">delta</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">):</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>            <span class="n">Q</span><span class="p">,</span> <span class="n">eigval</span> <span class="o">=</span> <span class="n">Qs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>            <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Q</span> <span class="o">@</span> <span class="n">torch</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">eigval</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">exponent</span><span class="p">))</span> <span class="o">@</span> <span class="n">Q</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>            <span class="n">Q1</span><span class="p">,</span> <span class="n">Q2</span> <span class="o">=</span> <span class="n">Qs</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>            <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="n">ls</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>            <span class="n">Q</span> <span class="o">=</span> <span class="n">kron</span><span class="p">(</span><span class="n">Q1</span><span class="p">,</span> <span class="n">Q2</span><span class="p">)</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping</span><span class="p">:</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>                <span class="n">delta_sqrt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>                <span class="n">eigval</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">l1</span> <span class="o">+</span> <span class="n">delta_sqrt</span><span class="p">,</span> <span class="n">l2</span> <span class="o">+</span> <span class="n">delta_sqrt</span><span class="p">),</span> <span class="n">exponent</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                <span class="p">)</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>                <span class="n">eigval</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">)</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>            <span class="n">L</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">eigval</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>            <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Q</span> <span class="o">@</span> <span class="n">L</span> <span class="o">@</span> <span class="n">Q</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="k">return</span> <span class="n">block_diag</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="laplace.utils.SubnetMask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">SubnetMask</span>


<a href="#laplace.utils.SubnetMask" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">SubnetMask</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.SubnetMask(model)">model</a></span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


        <p>Baseclass for all subnetwork masks in this library (for subnetwork Laplace).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.SubnetMask(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
<a href="#laplace.utils.SubnetMask(model)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.nn.Module">Module</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.SubnetMask.convert_subnet_mask_to_indices" href="#laplace.utils.SubnetMask.convert_subnet_mask_to_indices">convert_subnet_mask_to_indices</a></code></b>
            –
            <div class="doc-md-description">
              <p>Converts a subnetwork mask into subnetwork indices.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.SubnetMask.select" href="#laplace.utils.SubnetMask.select">select</a></code></b>
            –
            <div class="doc-md-description">
              <p>Select the subnetwork mask.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.SubnetMask.get_subnet_mask" href="#laplace.utils.SubnetMask.get_subnet_mask">get_subnet_mask</a></code></b>
            –
            <div class="doc-md-description">
              <p>Get the subnetwork mask.</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="n">model</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vector</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="n">parameters_to_vector</span><span class="p">(</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">()</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vector</span><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_n_params_subnet</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="laplace.utils.SubnetMask.convert_subnet_mask_to_indices" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">convert_subnet_mask_to_indices</span>


<a href="#laplace.utils.SubnetMask.convert_subnet_mask_to_indices" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.SubnetMask.convert_subnet_mask_to_indices(subnet_mask)">subnet_mask</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Converts a subnetwork mask into subnetwork indices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.SubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="doc doc-heading doc-heading-parameter">              <b><code>subnet_mask</code></b>
<a href="#laplace.utils.SubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>a binary vector of size (n_params) where 1s locate the subnetwork parameters
within the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="k">def</span> <span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">subnet_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a subnetwork mask into subnetwork indices.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    subnet_mask : torch.Tensor</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        a binary vector of size (n_params) where 1s locate the subnetwork parameters</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        within the vectorized model parameters</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    -------</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask needs to be torch.Tensor!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">subnet_mask</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="p">]</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="p">):</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="s2">&quot;Subnetwork mask needs to be 1-dimensional integral or boolean tensor!&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="s2">&quot;Subnetwork mask needs to be a binary vector of&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="s2">&quot;size (n_params) where 1s locate the subnetwork&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="s2">&quot;parameters within the vectorized model parameters&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="s2">&quot;(i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)!&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">subnet_mask_indices</span> <span class="o">=</span> <span class="n">subnet_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">as_tuple</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">return</span> <span class="n">subnet_mask_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.SubnetMask.select" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">select</span>


<a href="#laplace.utils.SubnetMask.select" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">select</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.SubnetMask.select(train_loader)">train_loader</a></span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Select the subnetwork mask.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.SubnetMask.select(train_loader)" class="doc doc-heading doc-heading-parameter">              <b><code>train_loader</code></b>
<a href="#laplace.utils.SubnetMask.select(train_loader)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.data.utils.DataLoader">DataLoader</span></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>each iterate is a training batch (X, y);
<code>train_loader.dataset</code> needs to be set to access <span class="arithmatex">\(N\)</span>, size of the data set</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the subnetwork mask.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    train_loader : torch.data.utils.DataLoader, default=None</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        each iterate is a training batch (X, y);</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        `train_loader.dataset` needs to be set to access \\(N\\), size of the data set</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    -------</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask already selected.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.SubnetMask.get_subnet_mask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_subnet_mask</span>


<a href="#laplace.utils.SubnetMask.get_subnet_mask" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_subnet_mask</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.SubnetMask.get_subnet_mask(train_loader)">train_loader</a></span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the subnetwork mask.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.SubnetMask.get_subnet_mask(train_loader)" class="doc doc-heading doc-heading-parameter">              <b><code>train_loader</code></b>
<a href="#laplace.utils.SubnetMask.get_subnet_mask(train_loader)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.data.utils.DataLoader">DataLoader</span></code>)
          –
          <div class="doc-md-description">
            <p>each iterate is a training batch (X, y);
<code>train_loader.dataset</code> needs to be set to access <span class="arithmatex">\(N\)</span>, size of the data set</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a binary vector of size (n_params) where 1s locate the subnetwork parameters
within the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="k">def</span> <span class="nf">get_subnet_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the subnetwork mask.</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">    train_loader : torch.data.utils.DataLoader</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        each iterate is a training batch (X, y);</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        `train_loader.dataset` needs to be set to access \\(N\\), size of the data set</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    -------</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    subnet_mask: torch.Tensor</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        a binary vector of size (n_params) where 1s locate the subnetwork parameters</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">        within the vectorized model parameters</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="laplace.utils.RandomSubnetMask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">RandomSubnetMask</span>


<a href="#laplace.utils.RandomSubnetMask" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">RandomSubnetMask</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span><span class="p">,</span> <span class="n">n_params_subnet</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="laplace.utils.subnetmask.ScoreBasedSubnetMask">ScoreBasedSubnetMask</span></code></p>


        <p>Subnetwork mask of parameters sampled uniformly at random.</p>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.RandomSubnetMask.convert_subnet_mask_to_indices" href="#laplace.utils.RandomSubnetMask.convert_subnet_mask_to_indices">convert_subnet_mask_to_indices</a></code></b>
            –
            <div class="doc-md-description">
              <p>Converts a subnetwork mask into subnetwork indices.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.RandomSubnetMask.select" href="#laplace.utils.RandomSubnetMask.select">select</a></code></b>
            –
            <div class="doc-md-description">
              <p>Select the subnetwork mask.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.RandomSubnetMask.get_subnet_mask" href="#laplace.utils.RandomSubnetMask.get_subnet_mask">get_subnet_mask</a></code></b>
            –
            <div class="doc-md-description">
              <p>Get the subnetwork mask by (descendingly) ranking parameters based on their scores.</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">n_params_subnet</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">if</span> <span class="n">n_params_subnet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="s2">&quot;Need to pass number of subnetwork parameters when using subnetwork Laplace.&quot;</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="k">if</span> <span class="n">n_params_subnet</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span><span class="p">:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="sa">f</span><span class="s2">&quot;Subnetwork (</span><span class="si">{</span><span class="n">n_params_subnet</span><span class="si">}</span><span class="s2">) cannot be larger than model (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span><span class="si">}</span><span class="s2">).&quot;</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="p">)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_n_params_subnet</span> <span class="o">=</span> <span class="n">n_params_subnet</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="laplace.utils.RandomSubnetMask.convert_subnet_mask_to_indices" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">convert_subnet_mask_to_indices</span>


<a href="#laplace.utils.RandomSubnetMask.convert_subnet_mask_to_indices" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.RandomSubnetMask.convert_subnet_mask_to_indices(subnet_mask)">subnet_mask</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Converts a subnetwork mask into subnetwork indices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.RandomSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="doc doc-heading doc-heading-parameter">              <b><code>subnet_mask</code></b>
<a href="#laplace.utils.RandomSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>a binary vector of size (n_params) where 1s locate the subnetwork parameters
within the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="k">def</span> <span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">subnet_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a subnetwork mask into subnetwork indices.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    subnet_mask : torch.Tensor</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        a binary vector of size (n_params) where 1s locate the subnetwork parameters</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        within the vectorized model parameters</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    -------</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask needs to be torch.Tensor!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">subnet_mask</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="p">]</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="p">):</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="s2">&quot;Subnetwork mask needs to be 1-dimensional integral or boolean tensor!&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="s2">&quot;Subnetwork mask needs to be a binary vector of&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="s2">&quot;size (n_params) where 1s locate the subnetwork&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="s2">&quot;parameters within the vectorized model parameters&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="s2">&quot;(i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)!&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">subnet_mask_indices</span> <span class="o">=</span> <span class="n">subnet_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">as_tuple</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">return</span> <span class="n">subnet_mask_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.RandomSubnetMask.select" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">select</span>


<a href="#laplace.utils.RandomSubnetMask.select" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">select</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.RandomSubnetMask.select(train_loader)">train_loader</a></span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Select the subnetwork mask.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.RandomSubnetMask.select(train_loader)" class="doc doc-heading doc-heading-parameter">              <b><code>train_loader</code></b>
<a href="#laplace.utils.RandomSubnetMask.select(train_loader)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.data.utils.DataLoader">DataLoader</span></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>each iterate is a training batch (X, y);
<code>train_loader.dataset</code> needs to be set to access <span class="arithmatex">\(N\)</span>, size of the data set</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the subnetwork mask.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    train_loader : torch.data.utils.DataLoader, default=None</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        each iterate is a training batch (X, y);</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        `train_loader.dataset` needs to be set to access \\(N\\), size of the data set</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    -------</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask already selected.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.RandomSubnetMask.get_subnet_mask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_subnet_mask</span>


<a href="#laplace.utils.RandomSubnetMask.get_subnet_mask" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the subnetwork mask by (descendingly) ranking parameters based on their scores.</p>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="k">def</span> <span class="nf">get_subnet_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">):</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the subnetwork mask by (descendingly) ranking parameters based on their scores.&quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_param_scores</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_param_scores</span><span class="p">()</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params_subnet</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="p">]</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">sort</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vector</span><span class="p">)</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="n">subnet_mask</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="k">return</span> <span class="n">subnet_mask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="laplace.utils.LargestMagnitudeSubnetMask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">LargestMagnitudeSubnetMask</span>


<a href="#laplace.utils.LargestMagnitudeSubnetMask" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">LargestMagnitudeSubnetMask</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span><span class="p">,</span> <span class="n">n_params_subnet</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="laplace.utils.subnetmask.ScoreBasedSubnetMask">ScoreBasedSubnetMask</span></code></p>


        <p>Subnetwork mask identifying the parameters with the largest magnitude.</p>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LargestMagnitudeSubnetMask.convert_subnet_mask_to_indices" href="#laplace.utils.LargestMagnitudeSubnetMask.convert_subnet_mask_to_indices">convert_subnet_mask_to_indices</a></code></b>
            –
            <div class="doc-md-description">
              <p>Converts a subnetwork mask into subnetwork indices.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LargestMagnitudeSubnetMask.select" href="#laplace.utils.LargestMagnitudeSubnetMask.select">select</a></code></b>
            –
            <div class="doc-md-description">
              <p>Select the subnetwork mask.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LargestMagnitudeSubnetMask.get_subnet_mask" href="#laplace.utils.LargestMagnitudeSubnetMask.get_subnet_mask">get_subnet_mask</a></code></b>
            –
            <div class="doc-md-description">
              <p>Get the subnetwork mask by (descendingly) ranking parameters based on their scores.</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">n_params_subnet</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">if</span> <span class="n">n_params_subnet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="s2">&quot;Need to pass number of subnetwork parameters when using subnetwork Laplace.&quot;</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="k">if</span> <span class="n">n_params_subnet</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span><span class="p">:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="sa">f</span><span class="s2">&quot;Subnetwork (</span><span class="si">{</span><span class="n">n_params_subnet</span><span class="si">}</span><span class="s2">) cannot be larger than model (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span><span class="si">}</span><span class="s2">).&quot;</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="p">)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_n_params_subnet</span> <span class="o">=</span> <span class="n">n_params_subnet</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="laplace.utils.LargestMagnitudeSubnetMask.convert_subnet_mask_to_indices" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">convert_subnet_mask_to_indices</span>


<a href="#laplace.utils.LargestMagnitudeSubnetMask.convert_subnet_mask_to_indices" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestMagnitudeSubnetMask.convert_subnet_mask_to_indices(subnet_mask)">subnet_mask</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Converts a subnetwork mask into subnetwork indices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.LargestMagnitudeSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="doc doc-heading doc-heading-parameter">              <b><code>subnet_mask</code></b>
<a href="#laplace.utils.LargestMagnitudeSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>a binary vector of size (n_params) where 1s locate the subnetwork parameters
within the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="k">def</span> <span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">subnet_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a subnetwork mask into subnetwork indices.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    subnet_mask : torch.Tensor</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        a binary vector of size (n_params) where 1s locate the subnetwork parameters</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        within the vectorized model parameters</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    -------</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask needs to be torch.Tensor!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">subnet_mask</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="p">]</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="p">):</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="s2">&quot;Subnetwork mask needs to be 1-dimensional integral or boolean tensor!&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="s2">&quot;Subnetwork mask needs to be a binary vector of&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="s2">&quot;size (n_params) where 1s locate the subnetwork&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="s2">&quot;parameters within the vectorized model parameters&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="s2">&quot;(i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)!&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">subnet_mask_indices</span> <span class="o">=</span> <span class="n">subnet_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">as_tuple</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">return</span> <span class="n">subnet_mask_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.LargestMagnitudeSubnetMask.select" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">select</span>


<a href="#laplace.utils.LargestMagnitudeSubnetMask.select" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">select</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestMagnitudeSubnetMask.select(train_loader)">train_loader</a></span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Select the subnetwork mask.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.LargestMagnitudeSubnetMask.select(train_loader)" class="doc doc-heading doc-heading-parameter">              <b><code>train_loader</code></b>
<a href="#laplace.utils.LargestMagnitudeSubnetMask.select(train_loader)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.data.utils.DataLoader">DataLoader</span></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>each iterate is a training batch (X, y);
<code>train_loader.dataset</code> needs to be set to access <span class="arithmatex">\(N\)</span>, size of the data set</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the subnetwork mask.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    train_loader : torch.data.utils.DataLoader, default=None</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        each iterate is a training batch (X, y);</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        `train_loader.dataset` needs to be set to access \\(N\\), size of the data set</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    -------</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask already selected.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.LargestMagnitudeSubnetMask.get_subnet_mask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_subnet_mask</span>


<a href="#laplace.utils.LargestMagnitudeSubnetMask.get_subnet_mask" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the subnetwork mask by (descendingly) ranking parameters based on their scores.</p>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="k">def</span> <span class="nf">get_subnet_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">):</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the subnetwork mask by (descendingly) ranking parameters based on their scores.&quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_param_scores</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_param_scores</span><span class="p">()</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params_subnet</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="p">]</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">sort</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vector</span><span class="p">)</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="n">subnet_mask</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="k">return</span> <span class="n">subnet_mask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="laplace.utils.LargestVarianceDiagLaplaceSubnetMask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">LargestVarianceDiagLaplaceSubnetMask</span>


<a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">LargestVarianceDiagLaplaceSubnetMask</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask(model)">model</a></span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask(n_params_subnet)">n_params_subnet</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask(diag_laplace_model)">diag_laplace_model</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.baselaplace.DiagLaplace" href="../parametriclaplace/#laplace.baselaplace.DiagLaplace">DiagLaplace</a></span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="laplace.utils.subnetmask.ScoreBasedSubnetMask">ScoreBasedSubnetMask</span></code></p>


        <p>Subnetwork mask identifying the parameters with the largest marginal variances
(estimated using a diagonal Laplace approximation over all model parameters).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.LargestVarianceDiagLaplaceSubnetMask(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
<a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask(model)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.nn.Module">Module</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.LargestVarianceDiagLaplaceSubnetMask(n_params_subnet)" class="doc doc-heading doc-heading-parameter">              <b><code>n_params_subnet</code></b>
<a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask(n_params_subnet)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          –
          <div class="doc-md-description">
            <p>number of parameters in the subnetwork (i.e. number of top-scoring parameters to select)</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.LargestVarianceDiagLaplaceSubnetMask(diag_laplace_model)" class="doc doc-heading doc-heading-parameter">              <b><code>diag_laplace_model</code></b>
<a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask(diag_laplace_model)" class="headerlink" title="Permanent link">#</a></h3>              (<code>`laplace.baselaplace.DiagLaplace`</code>)
          –
          <div class="doc-md-description">
            <p>diagonal Laplace model to use for variance estimation</p>
          </div>
        </li>
    </ul>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LargestVarianceDiagLaplaceSubnetMask.convert_subnet_mask_to_indices" href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.convert_subnet_mask_to_indices">convert_subnet_mask_to_indices</a></code></b>
            –
            <div class="doc-md-description">
              <p>Converts a subnetwork mask into subnetwork indices.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LargestVarianceDiagLaplaceSubnetMask.select" href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.select">select</a></code></b>
            –
            <div class="doc-md-description">
              <p>Select the subnetwork mask.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LargestVarianceDiagLaplaceSubnetMask.get_subnet_mask" href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.get_subnet_mask">get_subnet_mask</a></code></b>
            –
            <div class="doc-md-description">
              <p>Get the subnetwork mask by (descendingly) ranking parameters based on their scores.</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="n">n_params_subnet</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="n">diag_laplace_model</span><span class="p">:</span> <span class="n">laplace</span><span class="o">.</span><span class="n">baselaplace</span><span class="o">.</span><span class="n">DiagLaplace</span><span class="p">,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="p">):</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">n_params_subnet</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">diag_laplace_model</span><span class="p">:</span> <span class="n">laplace</span><span class="o">.</span><span class="n">baselaplace</span><span class="o">.</span><span class="n">DiagLaplace</span> <span class="o">=</span> <span class="n">diag_laplace_model</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="laplace.utils.LargestVarianceDiagLaplaceSubnetMask.convert_subnet_mask_to_indices" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">convert_subnet_mask_to_indices</span>


<a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.convert_subnet_mask_to_indices" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.convert_subnet_mask_to_indices(subnet_mask)">subnet_mask</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Converts a subnetwork mask into subnetwork indices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.LargestVarianceDiagLaplaceSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="doc doc-heading doc-heading-parameter">              <b><code>subnet_mask</code></b>
<a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>a binary vector of size (n_params) where 1s locate the subnetwork parameters
within the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="k">def</span> <span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">subnet_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a subnetwork mask into subnetwork indices.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    subnet_mask : torch.Tensor</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        a binary vector of size (n_params) where 1s locate the subnetwork parameters</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        within the vectorized model parameters</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    -------</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask needs to be torch.Tensor!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">subnet_mask</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="p">]</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="p">):</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="s2">&quot;Subnetwork mask needs to be 1-dimensional integral or boolean tensor!&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="s2">&quot;Subnetwork mask needs to be a binary vector of&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="s2">&quot;size (n_params) where 1s locate the subnetwork&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="s2">&quot;parameters within the vectorized model parameters&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="s2">&quot;(i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)!&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">subnet_mask_indices</span> <span class="o">=</span> <span class="n">subnet_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">as_tuple</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">return</span> <span class="n">subnet_mask_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.LargestVarianceDiagLaplaceSubnetMask.select" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">select</span>


<a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.select" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">select</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.select(train_loader)">train_loader</a></span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Select the subnetwork mask.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.LargestVarianceDiagLaplaceSubnetMask.select(train_loader)" class="doc doc-heading doc-heading-parameter">              <b><code>train_loader</code></b>
<a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.select(train_loader)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.data.utils.DataLoader">DataLoader</span></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>each iterate is a training batch (X, y);
<code>train_loader.dataset</code> needs to be set to access <span class="arithmatex">\(N\)</span>, size of the data set</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the subnetwork mask.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    train_loader : torch.data.utils.DataLoader, default=None</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        each iterate is a training batch (X, y);</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        `train_loader.dataset` needs to be set to access \\(N\\), size of the data set</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    -------</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask already selected.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.LargestVarianceDiagLaplaceSubnetMask.get_subnet_mask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_subnet_mask</span>


<a href="#laplace.utils.LargestVarianceDiagLaplaceSubnetMask.get_subnet_mask" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the subnetwork mask by (descendingly) ranking parameters based on their scores.</p>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="k">def</span> <span class="nf">get_subnet_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">):</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the subnetwork mask by (descendingly) ranking parameters based on their scores.&quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_param_scores</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_param_scores</span><span class="p">()</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params_subnet</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="p">]</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">sort</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vector</span><span class="p">)</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="n">subnet_mask</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="k">return</span> <span class="n">subnet_mask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="laplace.utils.LargestVarianceSWAGSubnetMask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">LargestVarianceSWAGSubnetMask</span>


<a href="#laplace.utils.LargestVarianceSWAGSubnetMask" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">LargestVarianceSWAGSubnetMask</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestVarianceSWAGSubnetMask(model)">model</a></span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestVarianceSWAGSubnetMask(n_params_subnet)">n_params_subnet</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestVarianceSWAGSubnetMask(likelihood)">likelihood</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.enums.Likelihood" href="../enums/#laplace.utils.enums.Likelihood">Likelihood</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.enums.Likelihood.CLASSIFICATION" href="../enums/#laplace.utils.enums.Likelihood.CLASSIFICATION">CLASSIFICATION</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestVarianceSWAGSubnetMask(swag_n_snapshots)">swag_n_snapshots</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestVarianceSWAGSubnetMask(swag_snapshot_freq)">swag_snapshot_freq</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestVarianceSWAGSubnetMask(swag_lr)">swag_lr</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="laplace.utils.subnetmask.ScoreBasedSubnetMask">ScoreBasedSubnetMask</span></code></p>


        <p>Subnetwork mask identifying the parameters with the largest marginal variances
(estimated using diagonal SWAG over all model parameters).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.LargestVarianceSWAGSubnetMask(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
<a href="#laplace.utils.LargestVarianceSWAGSubnetMask(model)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.nn.Module">Module</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.LargestVarianceSWAGSubnetMask(n_params_subnet)" class="doc doc-heading doc-heading-parameter">              <b><code>n_params_subnet</code></b>
<a href="#laplace.utils.LargestVarianceSWAGSubnetMask(n_params_subnet)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          –
          <div class="doc-md-description">
            <p>number of parameters in the subnetwork (i.e. number of top-scoring parameters to select)</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.LargestVarianceSWAGSubnetMask(likelihood)" class="doc doc-heading doc-heading-parameter">              <b><code>likelihood</code></b>
<a href="#laplace.utils.LargestVarianceSWAGSubnetMask(likelihood)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                  <code><a class="autorefs autorefs-internal" title="laplace.utils.enums.Likelihood.CLASSIFICATION" href="../enums/#laplace.utils.enums.Likelihood.CLASSIFICATION">CLASSIFICATION</a></code>
)
          –
          <div class="doc-md-description">
            <p>'classification' or 'regression'</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.LargestVarianceSWAGSubnetMask(swag_n_snapshots)" class="doc doc-heading doc-heading-parameter">              <b><code>swag_n_snapshots</code></b>
<a href="#laplace.utils.LargestVarianceSWAGSubnetMask(swag_n_snapshots)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>, default:
                  <code>40</code>
)
          –
          <div class="doc-md-description">
            <p>number of model snapshots to collect for SWAG</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.LargestVarianceSWAGSubnetMask(swag_snapshot_freq)" class="doc doc-heading doc-heading-parameter">              <b><code>swag_snapshot_freq</code></b>
<a href="#laplace.utils.LargestVarianceSWAGSubnetMask(swag_snapshot_freq)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>, default:
                  <code>1</code>
)
          –
          <div class="doc-md-description">
            <p>SWAG snapshot collection frequency (in epochs)</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.LargestVarianceSWAGSubnetMask(swag_lr)" class="doc doc-heading doc-heading-parameter">              <b><code>swag_lr</code></b>
<a href="#laplace.utils.LargestVarianceSWAGSubnetMask(swag_lr)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>0.01</code>
)
          –
          <div class="doc-md-description">
            <p>learning rate for SWAG snapshot collection</p>
          </div>
        </li>
    </ul>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LargestVarianceSWAGSubnetMask.convert_subnet_mask_to_indices" href="#laplace.utils.LargestVarianceSWAGSubnetMask.convert_subnet_mask_to_indices">convert_subnet_mask_to_indices</a></code></b>
            –
            <div class="doc-md-description">
              <p>Converts a subnetwork mask into subnetwork indices.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LargestVarianceSWAGSubnetMask.select" href="#laplace.utils.LargestVarianceSWAGSubnetMask.select">select</a></code></b>
            –
            <div class="doc-md-description">
              <p>Select the subnetwork mask.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LargestVarianceSWAGSubnetMask.get_subnet_mask" href="#laplace.utils.LargestVarianceSWAGSubnetMask.get_subnet_mask">get_subnet_mask</a></code></b>
            –
            <div class="doc-md-description">
              <p>Get the subnetwork mask by (descendingly) ranking parameters based on their scores.</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="n">n_params_subnet</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="n">likelihood</span><span class="p">:</span> <span class="n">Likelihood</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Likelihood</span><span class="o">.</span><span class="n">CLASSIFICATION</span><span class="p">,</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="n">swag_n_snapshots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="n">swag_snapshot_freq</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="n">swag_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="p">):</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="k">if</span> <span class="n">likelihood</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Likelihood</span><span class="o">.</span><span class="n">CLASSIFICATION</span><span class="p">,</span> <span class="n">Likelihood</span><span class="o">.</span><span class="n">REGRESSION</span><span class="p">]:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only available for classification and regression!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">n_params_subnet</span><span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="p">:</span> <span class="n">Likelihood</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">likelihood</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">swag_n_snapshots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">swag_n_snapshots</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">swag_snapshot_freq</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">swag_snapshot_freq</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">swag_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">swag_lr</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="laplace.utils.LargestVarianceSWAGSubnetMask.convert_subnet_mask_to_indices" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">convert_subnet_mask_to_indices</span>


<a href="#laplace.utils.LargestVarianceSWAGSubnetMask.convert_subnet_mask_to_indices" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestVarianceSWAGSubnetMask.convert_subnet_mask_to_indices(subnet_mask)">subnet_mask</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Converts a subnetwork mask into subnetwork indices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.LargestVarianceSWAGSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="doc doc-heading doc-heading-parameter">              <b><code>subnet_mask</code></b>
<a href="#laplace.utils.LargestVarianceSWAGSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>a binary vector of size (n_params) where 1s locate the subnetwork parameters
within the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="k">def</span> <span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">subnet_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a subnetwork mask into subnetwork indices.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    subnet_mask : torch.Tensor</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        a binary vector of size (n_params) where 1s locate the subnetwork parameters</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        within the vectorized model parameters</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    -------</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask needs to be torch.Tensor!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">subnet_mask</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="p">]</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="p">):</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="s2">&quot;Subnetwork mask needs to be 1-dimensional integral or boolean tensor!&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="s2">&quot;Subnetwork mask needs to be a binary vector of&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="s2">&quot;size (n_params) where 1s locate the subnetwork&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="s2">&quot;parameters within the vectorized model parameters&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="s2">&quot;(i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)!&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">subnet_mask_indices</span> <span class="o">=</span> <span class="n">subnet_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">as_tuple</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">return</span> <span class="n">subnet_mask_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.LargestVarianceSWAGSubnetMask.select" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">select</span>


<a href="#laplace.utils.LargestVarianceSWAGSubnetMask.select" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">select</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LargestVarianceSWAGSubnetMask.select(train_loader)">train_loader</a></span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Select the subnetwork mask.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.LargestVarianceSWAGSubnetMask.select(train_loader)" class="doc doc-heading doc-heading-parameter">              <b><code>train_loader</code></b>
<a href="#laplace.utils.LargestVarianceSWAGSubnetMask.select(train_loader)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.data.utils.DataLoader">DataLoader</span></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>each iterate is a training batch (X, y);
<code>train_loader.dataset</code> needs to be set to access <span class="arithmatex">\(N\)</span>, size of the data set</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the subnetwork mask.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    train_loader : torch.data.utils.DataLoader, default=None</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        each iterate is a training batch (X, y);</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        `train_loader.dataset` needs to be set to access \\(N\\), size of the data set</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    -------</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask already selected.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.LargestVarianceSWAGSubnetMask.get_subnet_mask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_subnet_mask</span>


<a href="#laplace.utils.LargestVarianceSWAGSubnetMask.get_subnet_mask" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the subnetwork mask by (descendingly) ranking parameters based on their scores.</p>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="k">def</span> <span class="nf">get_subnet_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">):</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the subnetwork mask by (descendingly) ranking parameters based on their scores.&quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_param_scores</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_param_scores</span><span class="p">()</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_param_scores</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params_subnet</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="p">]</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">sort</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vector</span><span class="p">)</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="n">subnet_mask</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="k">return</span> <span class="n">subnet_mask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="laplace.utils.ParamNameSubnetMask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ParamNameSubnetMask</span>


<a href="#laplace.utils.ParamNameSubnetMask" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">ParamNameSubnetMask</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.ParamNameSubnetMask(model)">model</a></span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.ParamNameSubnetMask(parameter_names)">parameter_names</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">])</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="laplace.utils.subnetmask.SubnetMask" href="#laplace.utils.SubnetMask">SubnetMask</a></code></p>


        <p>Subnetwork mask corresponding to the specified parameters of the neural network.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.ParamNameSubnetMask(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
<a href="#laplace.utils.ParamNameSubnetMask(model)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.nn.Module">Module</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.ParamNameSubnetMask(parameter_names)" class="doc doc-heading doc-heading-parameter">              <b><code>parameter_names</code></b>
<a href="#laplace.utils.ParamNameSubnetMask(parameter_names)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>)
          –
          <div class="doc-md-description">
            <p>list of names of the parameters (as in <code>model.named_parameters()</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.ParamNameSubnetMask.convert_subnet_mask_to_indices" href="#laplace.utils.ParamNameSubnetMask.convert_subnet_mask_to_indices">convert_subnet_mask_to_indices</a></code></b>
            –
            <div class="doc-md-description">
              <p>Converts a subnetwork mask into subnetwork indices.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.ParamNameSubnetMask.select" href="#laplace.utils.ParamNameSubnetMask.select">select</a></code></b>
            –
            <div class="doc-md-description">
              <p>Select the subnetwork mask.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.ParamNameSubnetMask.get_subnet_mask" href="#laplace.utils.ParamNameSubnetMask.get_subnet_mask">get_subnet_mask</a></code></b>
            –
            <div class="doc-md-description">
              <p>Get the subnetwork mask identifying the specified parameters.</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">parameter_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameter_names</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_n_params_subnet</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="laplace.utils.ParamNameSubnetMask.convert_subnet_mask_to_indices" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">convert_subnet_mask_to_indices</span>


<a href="#laplace.utils.ParamNameSubnetMask.convert_subnet_mask_to_indices" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.ParamNameSubnetMask.convert_subnet_mask_to_indices(subnet_mask)">subnet_mask</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Converts a subnetwork mask into subnetwork indices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.ParamNameSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="doc doc-heading doc-heading-parameter">              <b><code>subnet_mask</code></b>
<a href="#laplace.utils.ParamNameSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>a binary vector of size (n_params) where 1s locate the subnetwork parameters
within the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="k">def</span> <span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">subnet_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a subnetwork mask into subnetwork indices.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    subnet_mask : torch.Tensor</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        a binary vector of size (n_params) where 1s locate the subnetwork parameters</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        within the vectorized model parameters</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    -------</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask needs to be torch.Tensor!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">subnet_mask</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="p">]</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="p">):</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="s2">&quot;Subnetwork mask needs to be 1-dimensional integral or boolean tensor!&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="s2">&quot;Subnetwork mask needs to be a binary vector of&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="s2">&quot;size (n_params) where 1s locate the subnetwork&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="s2">&quot;parameters within the vectorized model parameters&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="s2">&quot;(i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)!&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">subnet_mask_indices</span> <span class="o">=</span> <span class="n">subnet_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">as_tuple</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">return</span> <span class="n">subnet_mask_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.ParamNameSubnetMask.select" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">select</span>


<a href="#laplace.utils.ParamNameSubnetMask.select" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">select</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.ParamNameSubnetMask.select(train_loader)">train_loader</a></span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Select the subnetwork mask.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.ParamNameSubnetMask.select(train_loader)" class="doc doc-heading doc-heading-parameter">              <b><code>train_loader</code></b>
<a href="#laplace.utils.ParamNameSubnetMask.select(train_loader)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.data.utils.DataLoader">DataLoader</span></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>each iterate is a training batch (X, y);
<code>train_loader.dataset</code> needs to be set to access <span class="arithmatex">\(N\)</span>, size of the data set</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the subnetwork mask.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    train_loader : torch.data.utils.DataLoader, default=None</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        each iterate is a training batch (X, y);</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        `train_loader.dataset` needs to be set to access \\(N\\), size of the data set</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    -------</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask already selected.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.ParamNameSubnetMask.get_subnet_mask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_subnet_mask</span>


<a href="#laplace.utils.ParamNameSubnetMask.get_subnet_mask" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the subnetwork mask identifying the specified parameters.</p>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="k">def</span> <span class="nf">get_subnet_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the subnetwork mask identifying the specified parameters.&quot;&quot;&quot;</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_param_names</span><span class="p">()</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="n">subnet_mask_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">():</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_names</span><span class="p">:</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="n">mask_method</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="n">mask_method</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="n">subnet_mask_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mask_method</span><span class="p">(</span><span class="n">parameters_to_vector</span><span class="p">(</span><span class="n">param</span><span class="p">)))</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">subnet_mask_list</span><span class="p">)</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="k">return</span> <span class="n">subnet_mask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="laplace.utils.ModuleNameSubnetMask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ModuleNameSubnetMask</span>


<a href="#laplace.utils.ModuleNameSubnetMask" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">ModuleNameSubnetMask</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.ModuleNameSubnetMask(model)">model</a></span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span><span class="p">,</span> <span class="n">module_names</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">])</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="laplace.utils.subnetmask.SubnetMask" href="#laplace.utils.SubnetMask">SubnetMask</a></code></p>


        <p>Subnetwork mask corresponding to the specified modules of the neural network.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.ModuleNameSubnetMask(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
<a href="#laplace.utils.ModuleNameSubnetMask(model)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.nn.Module">Module</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.ModuleNameSubnetMask(parameter_names)" class="doc doc-heading doc-heading-parameter">              <b><code>parameter_names</code></b>
<a href="#laplace.utils.ModuleNameSubnetMask(parameter_names)" class="headerlink" title="Permanent link">#</a></h3>          –
          <div class="doc-md-description">
            <p>list of names of the modules (as in <code>model.named_modules()</code>) that define the subnetwork;
the modules cannot have children, i.e. need to be leaf modules</p>
          </div>
        </li>
    </ul>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.ModuleNameSubnetMask.convert_subnet_mask_to_indices" href="#laplace.utils.ModuleNameSubnetMask.convert_subnet_mask_to_indices">convert_subnet_mask_to_indices</a></code></b>
            –
            <div class="doc-md-description">
              <p>Converts a subnetwork mask into subnetwork indices.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.ModuleNameSubnetMask.select" href="#laplace.utils.ModuleNameSubnetMask.select">select</a></code></b>
            –
            <div class="doc-md-description">
              <p>Select the subnetwork mask.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.ModuleNameSubnetMask.get_subnet_mask" href="#laplace.utils.ModuleNameSubnetMask.get_subnet_mask">get_subnet_mask</a></code></b>
            –
            <div class="doc-md-description">
              <p>Get the subnetwork mask identifying the specified modules.</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">module_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_module_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">module_names</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_n_params_subnet</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="laplace.utils.ModuleNameSubnetMask.convert_subnet_mask_to_indices" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">convert_subnet_mask_to_indices</span>


<a href="#laplace.utils.ModuleNameSubnetMask.convert_subnet_mask_to_indices" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.ModuleNameSubnetMask.convert_subnet_mask_to_indices(subnet_mask)">subnet_mask</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Converts a subnetwork mask into subnetwork indices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.ModuleNameSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="doc doc-heading doc-heading-parameter">              <b><code>subnet_mask</code></b>
<a href="#laplace.utils.ModuleNameSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>a binary vector of size (n_params) where 1s locate the subnetwork parameters
within the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="k">def</span> <span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">subnet_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a subnetwork mask into subnetwork indices.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    subnet_mask : torch.Tensor</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        a binary vector of size (n_params) where 1s locate the subnetwork parameters</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        within the vectorized model parameters</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    -------</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask needs to be torch.Tensor!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">subnet_mask</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="p">]</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="p">):</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="s2">&quot;Subnetwork mask needs to be 1-dimensional integral or boolean tensor!&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="s2">&quot;Subnetwork mask needs to be a binary vector of&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="s2">&quot;size (n_params) where 1s locate the subnetwork&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="s2">&quot;parameters within the vectorized model parameters&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="s2">&quot;(i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)!&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">subnet_mask_indices</span> <span class="o">=</span> <span class="n">subnet_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">as_tuple</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">return</span> <span class="n">subnet_mask_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.ModuleNameSubnetMask.select" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">select</span>


<a href="#laplace.utils.ModuleNameSubnetMask.select" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">select</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.ModuleNameSubnetMask.select(train_loader)">train_loader</a></span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Select the subnetwork mask.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.ModuleNameSubnetMask.select(train_loader)" class="doc doc-heading doc-heading-parameter">              <b><code>train_loader</code></b>
<a href="#laplace.utils.ModuleNameSubnetMask.select(train_loader)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.data.utils.DataLoader">DataLoader</span></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>each iterate is a training batch (X, y);
<code>train_loader.dataset</code> needs to be set to access <span class="arithmatex">\(N\)</span>, size of the data set</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the subnetwork mask.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    train_loader : torch.data.utils.DataLoader, default=None</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        each iterate is a training batch (X, y);</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        `train_loader.dataset` needs to be set to access \\(N\\), size of the data set</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    -------</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask already selected.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.ModuleNameSubnetMask.get_subnet_mask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_subnet_mask</span>


<a href="#laplace.utils.ModuleNameSubnetMask.get_subnet_mask" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the subnetwork mask identifying the specified modules.</p>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="k">def</span> <span class="nf">get_subnet_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the subnetwork mask identifying the specified modules.&quot;&quot;&quot;</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_module_names</span><span class="p">()</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="n">subnet_mask_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">named_modules</span><span class="p">():</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">children</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>            <span class="k">continue</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_module_names</span><span class="p">:</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="n">mask_method</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="n">mask_method</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="n">subnet_mask_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="n">mask_method</span><span class="p">(</span><span class="n">parameters_to_vector</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">parameters</span><span class="p">()))</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="p">)</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">subnet_mask_list</span><span class="p">)</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="k">return</span> <span class="n">subnet_mask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="laplace.utils.LastLayerSubnetMask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">LastLayerSubnetMask</span>


<a href="#laplace.utils.LastLayerSubnetMask" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">LastLayerSubnetMask</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LastLayerSubnetMask(model)">model</a></span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LastLayerSubnetMask(last_layer_name)">last_layer_name</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="laplace.utils.subnetmask.ModuleNameSubnetMask" href="#laplace.utils.ModuleNameSubnetMask">ModuleNameSubnetMask</a></code></p>


        <p>Subnetwork mask corresponding to the last layer of the neural network.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.LastLayerSubnetMask(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
<a href="#laplace.utils.LastLayerSubnetMask(model)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.nn.Module">Module</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.LastLayerSubnetMask(last_layer_name)" class="doc doc-heading doc-heading-parameter">              <b><code>last_layer_name</code></b>
<a href="#laplace.utils.LastLayerSubnetMask(last_layer_name)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>name of the model's last layer, if None it will be determined automatically</p>
          </div>
        </li>
    </ul>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LastLayerSubnetMask.convert_subnet_mask_to_indices" href="#laplace.utils.LastLayerSubnetMask.convert_subnet_mask_to_indices">convert_subnet_mask_to_indices</a></code></b>
            –
            <div class="doc-md-description">
              <p>Converts a subnetwork mask into subnetwork indices.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LastLayerSubnetMask.select" href="#laplace.utils.LastLayerSubnetMask.select">select</a></code></b>
            –
            <div class="doc-md-description">
              <p>Select the subnetwork mask.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.LastLayerSubnetMask.get_subnet_mask" href="#laplace.utils.LastLayerSubnetMask.get_subnet_mask">get_subnet_mask</a></code></b>
            –
            <div class="doc-md-description">
              <p>Get the subnetwork mask identifying the last layer.</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">last_layer_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_feature_extractor</span><span class="p">:</span> <span class="n">FeatureExtractor</span> <span class="o">=</span> <span class="n">FeatureExtractor</span><span class="p">(</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">last_layer_name</span><span class="o">=</span><span class="n">last_layer_name</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_n_params_subnet</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="laplace.utils.LastLayerSubnetMask.convert_subnet_mask_to_indices" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">convert_subnet_mask_to_indices</span>


<a href="#laplace.utils.LastLayerSubnetMask.convert_subnet_mask_to_indices" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LastLayerSubnetMask.convert_subnet_mask_to_indices(subnet_mask)">subnet_mask</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Converts a subnetwork mask into subnetwork indices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.LastLayerSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="doc doc-heading doc-heading-parameter">              <b><code>subnet_mask</code></b>
<a href="#laplace.utils.LastLayerSubnetMask.convert_subnet_mask_to_indices(subnet_mask)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>a binary vector of size (n_params) where 1s locate the subnetwork parameters
within the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="k">def</span> <span class="nf">convert_subnet_mask_to_indices</span><span class="p">(</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">subnet_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a subnetwork mask into subnetwork indices.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    subnet_mask : torch.Tensor</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        a binary vector of size (n_params) where 1s locate the subnetwork parameters</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        within the vectorized model parameters</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    -------</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask needs to be torch.Tensor!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">subnet_mask</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="p">]</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="p">):</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="s2">&quot;Subnetwork mask needs to be 1-dimensional integral or boolean tensor!&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">[</span><span class="n">subnet_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_params</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="s2">&quot;Subnetwork mask needs to be a binary vector of&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="s2">&quot;size (n_params) where 1s locate the subnetwork&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="s2">&quot;parameters within the vectorized model parameters&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="s2">&quot;(i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)!&quot;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">subnet_mask_indices</span> <span class="o">=</span> <span class="n">subnet_mask</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">as_tuple</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">return</span> <span class="n">subnet_mask_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.LastLayerSubnetMask.select" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">select</span>


<a href="#laplace.utils.LastLayerSubnetMask.select" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">select</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.LastLayerSubnetMask.select(train_loader)">train_loader</a></span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.LongTensor">LongTensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Select the subnetwork mask.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.LastLayerSubnetMask.select(train_loader)" class="doc doc-heading doc-heading-parameter">              <b><code>train_loader</code></b>
<a href="#laplace.utils.LastLayerSubnetMask.select(train_loader)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.data.utils.DataLoader">DataLoader</span></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>each iterate is a training batch (X, y);
<code>train_loader.dataset</code> needs to be set to access <span class="arithmatex">\(N\)</span>, size of the data set</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>subnet_mask_indices</code></b> (              <code><span title="torch.LongTensor">LongTensor</span></code>
)          –
          <div class="doc-md-description">
            <p>a vector of indices of the vectorized model parameters
(i.e. <code>torch.nn.utils.parameters_to_vector(model.parameters())</code>)
that define the subnetwork</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the subnetwork mask.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    train_loader : torch.data.utils.DataLoader, default=None</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        each iterate is a training batch (X, y);</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        `train_loader.dataset` needs to be set to access \\(N\\), size of the data set</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    -------</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    subnet_mask_indices : torch.LongTensor</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        a vector of indices of the vectorized model parameters</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        (i.e. `torch.nn.utils.parameters_to_vector(model.parameters())`)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        that define the subnetwork</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Subnetwork mask already selected.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">subnet_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_subnet_mask_to_indices</span><span class="p">(</span><span class="n">subnet_mask</span><span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="laplace.utils.LastLayerSubnetMask.get_subnet_mask" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_subnet_mask</span>


<a href="#laplace.utils.LastLayerSubnetMask.get_subnet_mask" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the subnetwork mask identifying the last layer.</p>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/subnetmask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="k">def</span> <span class="nf">get_subnet_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the subnetwork mask identifying the last layer.&quot;&quot;&quot;</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="k">if</span> <span class="n">train_loader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Need to pass train loader for subnet selection.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_feature_extractor</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_extractor</span><span class="o">.</span><span class="n">last_layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="n">X</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_loader</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_feature_extractor</span><span class="o">.</span><span class="n">find_last_layer</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">))</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_module_names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_feature_extractor</span><span class="o">.</span><span class="n">_last_layer_name</span><span class="p">]</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_subnet_mask</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="laplace.utils.RunningNLLMetric" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">RunningNLLMetric</span>


<a href="#laplace.utils.RunningNLLMetric" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">RunningNLLMetric</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.RunningNLLMetric(ignore_index)">ignore_index</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torchmetrics.Metric">Metric</span></code></p>


        <p>NLL metrics that</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.RunningNLLMetric(ignore_index)" class="doc doc-heading doc-heading-parameter">              <b><code>ignore_index</code></b>
<a href="#laplace.utils.RunningNLLMetric(ignore_index)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>, default:
                  <code>-100</code>
)
          –
          <div class="doc-md-description">
            <p>which class label to ignore when computing the NLL loss</p>
          </div>
        </li>
    </ul>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="laplace.utils.RunningNLLMetric.update" href="#laplace.utils.RunningNLLMetric.update">update</a></code></b>
            –
            <div class="doc-md-description">
              <p>Parameters</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>laplace/utils/metrics.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span><span class="s2">&quot;nll_sum&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">dist_reduce_fx</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">)</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_state</span><span class="p">(</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="s2">&quot;n_valid_labels&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">dist_reduce_fx</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="p">)</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ignore_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">ignore_index</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="laplace.utils.RunningNLLMetric.update" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">update</span>


<a href="#laplace.utils.RunningNLLMetric.update" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">update</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.RunningNLLMetric.update(probs)">probs</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.RunningNLLMetric.update(targets)">targets</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.RunningNLLMetric.update(probs)" class="doc doc-heading doc-heading-parameter">              <b><code>probs</code></b>
<a href="#laplace.utils.RunningNLLMetric.update(probs)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>probability tensor of shape (..., n_classes)</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="laplace.utils.RunningNLLMetric.update(targets)" class="doc doc-heading doc-heading-parameter">              <b><code>targets</code></b>
<a href="#laplace.utils.RunningNLLMetric.update(targets)" class="headerlink" title="Permanent link">#</a></h4>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>integer tensor of shape (...)</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/metrics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">probs</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    probs: torch.Tensor</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        probability tensor of shape (..., n_classes)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    targets: torch.Tensor</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        integer tensor of shape (...)</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="n">probs</span> <span class="o">=</span> <span class="n">probs</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">probs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">nll_sum</span> <span class="o">+=</span> <span class="n">F</span><span class="o">.</span><span class="n">nll_loss</span><span class="p">(</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="n">probs</span><span class="o">.</span><span class="n">log</span><span class="p">(),</span> <span class="n">targets</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_index</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="p">)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_valid_labels</span> <span class="o">+=</span> <span class="p">(</span><span class="n">targets</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_index</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="laplace.utils.get_nll" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">get_nll</span>


<a href="#laplace.utils.get_nll" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_nll</span><span class="p">(</span><span class="n">out_dist</span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>laplace/utils/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="k">def</span> <span class="nf">get_nll</span><span class="p">(</span><span class="n">out_dist</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">nll_loss</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">out_dist</span><span class="p">),</span> <span class="n">targets</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="laplace.utils.validate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">validate</span>


<a href="#laplace.utils.validate" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">validate</span><span class="p">(</span><span class="n">laplace</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.baselaplace.BaseLaplace" href="../baselaplace/#laplace.baselaplace.BaseLaplace">BaseLaplace</a></span><span class="p">,</span> <span class="n">val_loader</span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span><span class="p">,</span> <span class="n">loss</span><span class="p">:</span> <span class="n"><span title="torchmetrics.Metric">Metric</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[[</span><span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">],</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">]</span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[[</span><span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">],</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">],</span> <span class="n">pred_type</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.enums.PredType" href="../enums/#laplace.utils.enums.PredType">PredType</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.enums.PredType.GLM" href="../enums/#laplace.utils.enums.PredType.GLM">GLM</a></span><span class="p">,</span> <span class="n">link_approx</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.enums.LinkApprox" href="../enums/#laplace.utils.enums.LinkApprox">LinkApprox</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.enums.LinkApprox.PROBIT" href="../enums/#laplace.utils.enums.LinkApprox.PROBIT">PROBIT</a></span><span class="p">,</span> <span class="n">n_samples</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">dict_key_y</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="s1">&#39;labels&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>laplace/utils/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="k">def</span> <span class="nf">validate</span><span class="p">(</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">laplace</span><span class="p">:</span> <span class="n">laplace</span><span class="o">.</span><span class="n">baselaplace</span><span class="o">.</span><span class="n">BaseLaplace</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="n">val_loader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="n">loss</span><span class="p">:</span> <span class="n">torchmetrics</span><span class="o">.</span><span class="n">Metric</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="o">|</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="o">|</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="n">pred_type</span><span class="p">:</span> <span class="n">PredType</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">PredType</span><span class="o">.</span><span class="n">GLM</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">link_approx</span><span class="p">:</span> <span class="n">LinkApprox</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">LinkApprox</span><span class="o">.</span><span class="n">PROBIT</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="n">dict_key_y</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;labels&quot;</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">laplace</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="k">assert</span> <span class="nb">callable</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">Metric</span><span class="p">)</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="n">is_offline</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">Metric</span><span class="p">)</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="k">if</span> <span class="n">is_offline</span><span class="p">:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="n">output_means</span><span class="p">,</span> <span class="n">output_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="n">targets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">val_loader</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">MutableMapping</span><span class="p">):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">dict_key_y</span><span class="p">]</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">data</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">laplace</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">laplace</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">laplace</span><span class="p">(</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>            <span class="n">X</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="n">pred_type</span><span class="o">=</span><span class="n">pred_type</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>            <span class="n">link_approx</span><span class="o">=</span><span class="n">link_approx</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>            <span class="n">n_samples</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>            <span class="n">fitting</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>            <span class="k">if</span> <span class="n">is_offline</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>                <span class="n">output_means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>                <span class="n">output_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>                <span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>                    <span class="n">loss</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">out</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># If the online loss only accepts 2 args</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>                    <span class="n">loss</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="k">if</span> <span class="n">is_offline</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>                <span class="n">output_means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>                <span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="n">loss</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="k">if</span> <span class="n">is_offline</span><span class="p">:</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_vars</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">preds</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">output_means</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="k">return</span> <span class="n">loss</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="n">means</span><span class="p">,</span> <span class="n">variances</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">output_means</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">output_vars</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">return</span> <span class="n">loss</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">variances</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="c1"># Aggregate since torchmetrics output n_classes values for the MSE metric</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">return</span> <span class="n">loss</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="laplace.utils.parameters_per_layer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">parameters_per_layer</span>


<a href="#laplace.utils.parameters_per_layer" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">parameters_per_layer</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.parameters_per_layer(model)">model</a></span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get number of parameters per layer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.parameters_per_layer(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
<a href="#laplace.utils.parameters_per_layer(model)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.nn.Module">Module</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>params_per_layer</code></b> (              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="k">def</span> <span class="nf">parameters_per_layer</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get number of parameters per layer.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    model : torch.nn.Module</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    -------</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    params_per_layer : list[int]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">()]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="laplace.utils.invsqrt_precision" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">invsqrt_precision</span>


<a href="#laplace.utils.invsqrt_precision" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">invsqrt_precision</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.invsqrt_precision(M)">M</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute <code>M^{-0.5}</code> as a tridiagonal matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.invsqrt_precision(M)" class="doc doc-heading doc-heading-parameter">              <b><code>M</code></b>
<a href="#laplace.utils.invsqrt_precision(M)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>M_invsqrt</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="k">def</span> <span class="nf">invsqrt_precision</span><span class="p">(</span><span class="n">M</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute ``M^{-0.5}`` as a tridiagonal matrix.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    M : torch.Tensor</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    -------</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    M_invsqrt : torch.Tensor</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="k">return</span> <span class="n">_precision_to_scale_tril</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="laplace.utils.kron" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">kron</span>


<a href="#laplace.utils.kron" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">kron</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.kron(t1)">t1</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.kron(t2)">t2</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Computes the Kronecker product between two tensors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.kron(t1)" class="doc doc-heading doc-heading-parameter">              <b><code>t1</code></b>
<a href="#laplace.utils.kron(t1)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.kron(t2)" class="doc doc-heading doc-heading-parameter">              <b><code>t2</code></b>
<a href="#laplace.utils.kron(t2)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>kron_product</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="k">def</span> <span class="nf">kron</span><span class="p">(</span><span class="n">t1</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">t2</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the Kronecker product between two tensors.</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">    t1 : torch.Tensor</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    t2 : torch.Tensor</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    -------</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    kron_product : torch.Tensor</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="n">t1_height</span><span class="p">,</span> <span class="n">t1_width</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="n">t2_height</span><span class="p">,</span> <span class="n">t2_width</span> <span class="o">=</span> <span class="n">t2</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="n">out_height</span> <span class="o">=</span> <span class="n">t1_height</span> <span class="o">*</span> <span class="n">t2_height</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="n">out_width</span> <span class="o">=</span> <span class="n">t1_width</span> <span class="o">*</span> <span class="n">t2_width</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="n">tiled_t2</span> <span class="o">=</span> <span class="n">t2</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">t1_height</span><span class="p">,</span> <span class="n">t1_width</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="n">expanded_t1</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="n">t1</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">t2_height</span><span class="p">,</span> <span class="n">t2_width</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">out_height</span><span class="p">,</span> <span class="n">out_width</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="k">return</span> <span class="n">expanded_t1</span> <span class="o">*</span> <span class="n">tiled_t2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="laplace.utils.diagonal_add_scalar" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">diagonal_add_scalar</span>


<a href="#laplace.utils.diagonal_add_scalar" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">diagonal_add_scalar</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.diagonal_add_scalar(X)">X</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.diagonal_add_scalar(value)">value</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add scalar value <code>value</code> to diagonal of <code>X</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.diagonal_add_scalar(X)" class="doc doc-heading doc-heading-parameter">              <b><code>X</code></b>
<a href="#laplace.utils.diagonal_add_scalar(X)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.diagonal_add_scalar(value)" class="doc doc-heading doc-heading-parameter">              <b><code>value</code></b>
<a href="#laplace.utils.diagonal_add_scalar(value)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.Tensor">Tensor</span> or <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>X_add_scalar</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="k">def</span> <span class="nf">diagonal_add_scalar</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add scalar value `value` to diagonal of `X`.</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    X : torch.Tensor</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    value : torch.Tensor or float</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    -------</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    X_add_scalar : torch.Tensor</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> <span class="n">device</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="n">values</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">new_ones</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">return</span> <span class="n">X</span><span class="o">.</span><span class="n">index_put</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">indices</span><span class="o">.</span><span class="n">t</span><span class="p">()),</span> <span class="n">values</span><span class="p">,</span> <span class="n">accumulate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="laplace.utils.symeig" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">symeig</span>


<a href="#laplace.utils.symeig" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">symeig</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.symeig(M)">M</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a></span><span class="p">[</span><span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Symetric eigendecomposition avoiding failure cases by
adding and removing jitter to the diagonal.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.symeig(M)" class="doc doc-heading doc-heading-parameter">              <b><code>M</code></b>
<a href="#laplace.utils.symeig(M)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>L</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>eigenvalues</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>W</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>eigenvectors</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="k">def</span> <span class="nf">symeig</span><span class="p">(</span><span class="n">M</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Symetric eigendecomposition avoiding failure cases by</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    adding and removing jitter to the diagonal.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    M : torch.Tensor</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    -------</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    L : torch.Tensor</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        eigenvalues</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    W : torch.Tensor</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        eigenvectors</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="n">L</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">UPLO</span><span class="o">=</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>  <span class="c1"># did not converge</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;SYMEIG: adding jitter, did not converge.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="c1"># use W L W^T + I = W (L + I) W^T</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">M</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="n">L</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">UPLO</span><span class="o">=</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="n">L</span> <span class="o">-=</span> <span class="mf">1.0</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="n">stats</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;diag: </span><span class="si">{</span><span class="n">M</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span><span class="si">}</span><span class="s2">, max: </span><span class="si">{</span><span class="n">M</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;min: </span><span class="si">{</span><span class="n">M</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">, mean: </span><span class="si">{</span><span class="n">M</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SYMEIG: adding jitter failed. Stats: </span><span class="si">{</span><span class="n">stats</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="n">exit</span><span class="p">()</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="c1"># eigenvalues of symeig at least 0</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="n">L</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="n">W</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="k">return</span> <span class="n">L</span><span class="p">,</span> <span class="n">W</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="laplace.utils.block_diag" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">block_diag</span>


<a href="#laplace.utils.block_diag" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">block_diag</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.block_diag(blocks)">blocks</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></span><span class="p">[</span><span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compose block-diagonal matrix of individual blocks.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.block_diag(blocks)" class="doc doc-heading doc-heading-parameter">              <b><code>blocks</code></b>
<a href="#laplace.utils.block_diag(blocks)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<span title="torch.Tensor">Tensor</span>]</code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>M</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="k">def</span> <span class="nf">block_diag</span><span class="p">(</span><span class="n">blocks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compose block-diagonal matrix of individual blocks.</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    blocks : list[torch.Tensor]</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    -------</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    M : torch.Tensor</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="n">P</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">])</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="n">M</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="n">p_cur</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="n">p_block</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="n">M</span><span class="p">[</span><span class="n">p_cur</span> <span class="p">:</span> <span class="n">p_cur</span> <span class="o">+</span> <span class="n">p_block</span><span class="p">,</span> <span class="n">p_cur</span> <span class="p">:</span> <span class="n">p_cur</span> <span class="o">+</span> <span class="n">p_block</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">p_cur</span> <span class="o">+=</span> <span class="n">p_block</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="k">return</span> <span class="n">M</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="laplace.utils.normal_samples" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">normal_samples</span>


<a href="#laplace.utils.normal_samples" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">normal_samples</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.normal_samples(mean)">mean</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.normal_samples(var)">var</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n">n_samples</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.normal_samples(generator)">generator</a></span><span class="p">:</span> <span class="n"><span title="torch.Generator">Generator</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Produce samples from a batch of Normal distributions either parameterized
by a diagonal or full covariance given by <code>var</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.normal_samples(mean)" class="doc doc-heading doc-heading-parameter">              <b><code>mean</code></b>
<a href="#laplace.utils.normal_samples(mean)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p><code>(batch_size, output_dim)</code></p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.normal_samples(var)" class="doc doc-heading doc-heading-parameter">              <b><code>var</code></b>
<a href="#laplace.utils.normal_samples(var)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>(co)variance of the Normal distribution
<code>(batch_size, output_dim, output_dim)</code> or <code>(batch_size, output_dim)</code></p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.normal_samples(generator)" class="doc doc-heading doc-heading-parameter">              <b><code>generator</code></b>
<a href="#laplace.utils.normal_samples(generator)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.Generator">Generator</span></code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>random number generator</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="k">def</span> <span class="nf">normal_samples</span><span class="p">(</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="n">mean</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="n">var</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="n">generator</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Produce samples from a batch of Normal distributions either parameterized</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">    by a diagonal or full covariance given by `var`.</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">    mean : torch.Tensor</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        `(batch_size, output_dim)`</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">    var : torch.Tensor</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">        (co)variance of the Normal distribution</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">        `(batch_size, output_dim, output_dim)` or `(batch_size, output_dim)`</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">    generator : torch.Generator</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">        random number generator</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="k">assert</span> <span class="n">mean</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Invalid input shape of mean, should be 2-dimensional.&quot;</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>    <span class="n">_</span><span class="p">,</span> <span class="n">output_dim</span> <span class="o">=</span> <span class="n">mean</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="n">randn_samples</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="p">(</span><span class="n">output_dim</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">),</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="n">device</span><span class="o">=</span><span class="n">mean</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="n">dtype</span><span class="o">=</span><span class="n">mean</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="n">generator</span><span class="o">=</span><span class="n">generator</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="k">if</span> <span class="n">mean</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="c1"># diagonal covariance</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="n">scaled_samples</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">randn_samples</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">mean</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">scaled_samples</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="k">elif</span> <span class="n">mean</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">mean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="c1"># full covariance</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="n">scale</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="n">scaled_samples</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="n">scale</span><span class="p">,</span> <span class="n">randn_samples</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="p">)</span>  <span class="c1"># expand batch dim</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">mean</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">scaled_samples</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid input shapes.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="laplace.utils._is_batchnorm" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">_is_batchnorm</span>


<a href="#laplace.utils._is_batchnorm" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">_is_batchnorm</span><span class="p">(</span><span class="n">module</span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>laplace/utils/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="k">def</span> <span class="nf">_is_batchnorm</span><span class="p">(</span><span class="n">module</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="n">BatchNorm1d</span><span class="p">,</span> <span class="n">BatchNorm2d</span><span class="p">,</span> <span class="n">BatchNorm3d</span><span class="p">)):</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="laplace.utils._is_valid_scalar" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">_is_valid_scalar</span>


<a href="#laplace.utils._is_valid_scalar" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">_is_valid_scalar</span><span class="p">(</span><span class="n">scalar</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span> <span class="o">|</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>laplace/utils/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="k">def</span> <span class="nf">_is_valid_scalar</span><span class="p">(</span><span class="n">scalar</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isreal</span><span class="p">(</span><span class="n">scalar</span><span class="p">):</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="k">elif</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span> <span class="ow">and</span> <span class="n">scalar</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="k">if</span> <span class="n">scalar</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="laplace.utils.expand_prior_precision" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">expand_prior_precision</span>


<a href="#laplace.utils.expand_prior_precision" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">expand_prior_precision</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.expand_prior_precision(prior_prec)">prior_prec</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.expand_prior_precision(model)">model</a></span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Expand prior precision to match the shape of the model parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.expand_prior_precision(prior_prec)" class="doc doc-heading doc-heading-parameter">              <b><code>prior_prec</code></b>
<a href="#laplace.utils.expand_prior_precision(prior_prec)" class="headerlink" title="Permanent link">#</a></h3>              (<code>torch.Tensor 1-dimensional</code>)
          –
          <div class="doc-md-description">
            <p>prior precision</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.expand_prior_precision(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
<a href="#laplace.utils.expand_prior_precision(model)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.nn.Module">Module</span></code>)
          –
          <div class="doc-md-description">
            <p>torch model with parameters that are regularized by prior_prec</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>expanded_prior_prec</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>expanded prior precision has the same shape as model parameters</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="k">def</span> <span class="nf">expand_prior_precision</span><span class="p">(</span><span class="n">prior_prec</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Expand prior precision to match the shape of the model parameters.</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">    prior_prec : torch.Tensor 1-dimensional</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">        prior precision</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">    model : torch.nn.Module</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">        torch model with parameters that are regularized by prior_prec</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">    -------</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">    expanded_prior_prec : torch.Tensor</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        expanded prior precision has the same shape as model parameters</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="n">trainable_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">requires_grad</span><span class="p">]</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="n">theta</span> <span class="o">=</span> <span class="n">parameters_to_vector</span><span class="p">(</span><span class="n">trainable_params</span><span class="p">)</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">theta</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="k">assert</span> <span class="n">prior_prec</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prior_prec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># scalar</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span> <span class="o">*</span> <span class="n">prior_prec</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prior_prec</span><span class="p">)</span> <span class="o">==</span> <span class="n">P</span><span class="p">:</span>  <span class="c1"># full diagonal</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="k">return</span> <span class="n">prior_prec</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="p">[</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                <span class="n">delta</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>                <span class="k">for</span> <span class="n">delta</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">prior_prec</span><span class="p">,</span> <span class="n">trainable_params</span><span class="p">)</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="p">]</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="laplace.utils.fix_prior_prec_structure" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">fix_prior_prec_structure</span>


<a href="#laplace.utils.fix_prior_prec_structure" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">fix_prior_prec_structure</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fix_prior_prec_structure(prior_prec_init)">prior_prec_init</a></span><span class="p">:</span> <span class="n"><span title="torch.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fix_prior_prec_structure(prior_structure)">prior_structure</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="laplace.utils.enums.PriorStructure" href="../enums/#laplace.utils.enums.PriorStructure">PriorStructure</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fix_prior_prec_structure(n_layers)">n_layers</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fix_prior_prec_structure(n_params)">n_params</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fix_prior_prec_structure(device)">device</a></span><span class="p">:</span> <span class="n"><span title="torch.device">device</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fix_prior_prec_structure(dtype)">dtype</a></span><span class="p">:</span> <span class="n"><span title="torch.dtype">dtype</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a tensor of prior precision with the correct shape, depending on the
choice of the prior structure type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fix_prior_prec_structure(prior_prec_init)" class="doc doc-heading doc-heading-parameter">              <b><code>prior_prec_init</code></b>
<a href="#laplace.utils.fix_prior_prec_structure(prior_prec_init)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.Tensor">Tensor</span></code>)
          –
          <div class="doc-md-description">
            <p>the initial prior precision tensor (could be scalar)</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fix_prior_prec_structure(prior_structure)" class="doc doc-heading doc-heading-parameter">              <b><code>prior_structure</code></b>
<a href="#laplace.utils.fix_prior_prec_structure(prior_structure)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-internal" title="laplace.utils.enums.PriorStructure" href="../enums/#laplace.utils.enums.PriorStructure">PriorStructure</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
          –
          <div class="doc-md-description">
            <p>the choice of the prior structure type</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fix_prior_prec_structure(n_layers)" class="doc doc-heading doc-heading-parameter">              <b><code>n_layers</code></b>
<a href="#laplace.utils.fix_prior_prec_structure(n_layers)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fix_prior_prec_structure(n_params)" class="doc doc-heading doc-heading-parameter">              <b><code>n_params</code></b>
<a href="#laplace.utils.fix_prior_prec_structure(n_params)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fix_prior_prec_structure(device)" class="doc doc-heading doc-heading-parameter">              <b><code>device</code></b>
<a href="#laplace.utils.fix_prior_prec_structure(device)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.device">device</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fix_prior_prec_structure(dtype)" class="doc doc-heading doc-heading-parameter">              <b><code>dtype</code></b>
<a href="#laplace.utils.fix_prior_prec_structure(dtype)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.dtype">dtype</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>correct_prior_precision</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="k">def</span> <span class="nf">fix_prior_prec_structure</span><span class="p">(</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="n">prior_prec_init</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="n">prior_structure</span><span class="p">:</span> <span class="n">PriorStructure</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="n">n_layers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="n">n_params</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a tensor of prior precision with the correct shape, depending on the</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">    choice of the prior structure type.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">    prior_prec_init: torch.Tensor</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">        the initial prior precision tensor (could be scalar)</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">    prior_structure: PriorStructure | str</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">        the choice of the prior structure type</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    n_layers: int</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    n_params: int</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    device: torch.device</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">    dtype: torch.dtype</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">    -------</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">    correct_prior_precision: torch.Tensor</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="k">if</span> <span class="n">prior_structure</span> <span class="o">==</span> <span class="n">PriorStructure</span><span class="o">.</span><span class="n">SCALAR</span><span class="p">:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">prior_prec_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">1</span><span class="p">,),</span> <span class="n">prior_prec_init</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="k">elif</span> <span class="n">prior_structure</span> <span class="o">==</span> <span class="n">PriorStructure</span><span class="o">.</span><span class="n">LAYERWISE</span><span class="p">:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="n">prior_prec_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="p">(</span><span class="n">n_layers</span><span class="p">,),</span> <span class="n">prior_prec_init</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>    <span class="k">elif</span> <span class="n">prior_structure</span> <span class="o">==</span> <span class="n">PriorStructure</span><span class="o">.</span><span class="n">DIAG</span><span class="p">:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="n">prior_prec_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="p">(</span><span class="n">n_params</span><span class="p">,),</span> <span class="n">prior_prec_init</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="p">)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid prior structure </span><span class="si">{</span><span class="n">prior_structure</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="k">return</span> <span class="n">prior_prec_init</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="laplace.utils.fit_diagonal_swag_var" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">fit_diagonal_swag_var</span>


<a href="#laplace.utils.fit_diagonal_swag_var" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">fit_diagonal_swag_var</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fit_diagonal_swag_var(model)">model</a></span><span class="p">:</span> <span class="n"><span title="torch.nn.Module">Module</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fit_diagonal_swag_var(train_loader)">train_loader</a></span><span class="p">:</span> <span class="n"><span title="torch.utils.data.DataLoader">DataLoader</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fit_diagonal_swag_var(criterion)">criterion</a></span><span class="p">:</span> <span class="n"><span title="torch.nn.CrossEntropyLoss">CrossEntropyLoss</span></span> <span class="o">|</span> <span class="n"><span title="torch.nn.MSELoss">MSELoss</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fit_diagonal_swag_var(n_snapshots_total)">n_snapshots_total</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fit_diagonal_swag_var(snapshot_freq)">snapshot_freq</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fit_diagonal_swag_var(lr)">lr</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fit_diagonal_swag_var(momentum)">momentum</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fit_diagonal_swag_var(weight_decay)">weight_decay</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">=</span> <span class="mf">0.0003</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#laplace.utils.fit_diagonal_swag_var(min_var)">min_var</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">=</span> <span class="mf">1e-30</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="torch.Tensor">Tensor</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fit diagonal SWAG [1], which estimates marginal variances of model parameters by
computing the first and second moment of SGD iterates with a large learning rate.</p>
<p>Implementation partly adapted from:
- <a href="https://github.com/wjmaddox/swa_gaussian/blob/master/swag/posteriors/swag.py">https://github.com/wjmaddox/swa_gaussian/blob/master/swag/posteriors/swag.py</a>
- <a href="https://github.com/wjmaddox/swa_gaussian/blob/master/experiments/train/run_swag.py">https://github.com/wjmaddox/swa_gaussian/blob/master/experiments/train/run_swag.py</a></p>


<details class="references" open>
  <summary>References</summary>
  <p>[1] Maddox, W., Garipov, T., Izmailov, P., Vetrov, D., Wilson, AG.
<a href="https://arxiv.org/abs/1902.02476"><em>A Simple Baseline for Bayesian Uncertainty in Deep Learning</em></a>.
NeurIPS 2019.</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fit_diagonal_swag_var(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
<a href="#laplace.utils.fit_diagonal_swag_var(model)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.nn.Module">Module</span></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fit_diagonal_swag_var(train_loader)" class="doc doc-heading doc-heading-parameter">              <b><code>train_loader</code></b>
<a href="#laplace.utils.fit_diagonal_swag_var(train_loader)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.data.utils.DataLoader">DataLoader</span></code>)
          –
          <div class="doc-md-description">
            <p>training data loader to use for snapshot collection</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fit_diagonal_swag_var(criterion)" class="doc doc-heading doc-heading-parameter">              <b><code>criterion</code></b>
<a href="#laplace.utils.fit_diagonal_swag_var(criterion)" class="headerlink" title="Permanent link">#</a></h3>              (<code><span title="torch.nn.CrossEntropyLoss">CrossEntropyLoss</span> or <span title="torch.nn.MSELoss">MSELoss</span></code>)
          –
          <div class="doc-md-description">
            <p>loss function to use for snapshot collection</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fit_diagonal_swag_var(n_snapshots_total)" class="doc doc-heading doc-heading-parameter">              <b><code>n_snapshots_total</code></b>
<a href="#laplace.utils.fit_diagonal_swag_var(n_snapshots_total)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>, default:
                  <code>40</code>
)
          –
          <div class="doc-md-description">
            <p>total number of model snapshots to collect</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fit_diagonal_swag_var(snapshot_freq)" class="doc doc-heading doc-heading-parameter">              <b><code>snapshot_freq</code></b>
<a href="#laplace.utils.fit_diagonal_swag_var(snapshot_freq)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>, default:
                  <code>1</code>
)
          –
          <div class="doc-md-description">
            <p>snapshot collection frequency (in epochs)</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fit_diagonal_swag_var(lr)" class="doc doc-heading doc-heading-parameter">              <b><code>lr</code></b>
<a href="#laplace.utils.fit_diagonal_swag_var(lr)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>0.01</code>
)
          –
          <div class="doc-md-description">
            <p>SGD learning rate for collecting snapshots</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fit_diagonal_swag_var(momentum)" class="doc doc-heading doc-heading-parameter">              <b><code>momentum</code></b>
<a href="#laplace.utils.fit_diagonal_swag_var(momentum)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>0.9</code>
)
          –
          <div class="doc-md-description">
            <p>SGD momentum</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fit_diagonal_swag_var(weight_decay)" class="doc doc-heading doc-heading-parameter">              <b><code>weight_decay</code></b>
<a href="#laplace.utils.fit_diagonal_swag_var(weight_decay)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>0.0003</code>
)
          –
          <div class="doc-md-description">
            <p>SGD weight decay</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h3 id="laplace.utils.fit_diagonal_swag_var(min_var)" class="doc doc-heading doc-heading-parameter">              <b><code>min_var</code></b>
<a href="#laplace.utils.fit_diagonal_swag_var(min_var)" class="headerlink" title="Permanent link">#</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>1e-30</code>
)
          –
          <div class="doc-md-description">
            <p>minimum parameter variance to clamp to (for numerical stability)</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>param_variances</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>vector of marginal variances for each model parameter</p>
          </div>
        </li>
    </ul>

            <details class="quote">
              <summary>Source code in <code>laplace/utils/swag.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="k">def</span> <span class="nf">fit_diagonal_swag_var</span><span class="p">(</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">criterion</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span> <span class="o">|</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">n_snapshots_total</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">snapshot_freq</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">momentum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3e-4</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">min_var</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-30</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    Fit diagonal SWAG [1], which estimates marginal variances of model parameters by</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    computing the first and second moment of SGD iterates with a large learning rate.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Implementation partly adapted from:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    - https://github.com/wjmaddox/swa_gaussian/blob/master/swag/posteriors/swag.py</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    - https://github.com/wjmaddox/swa_gaussian/blob/master/experiments/train/run_swag.py</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    References</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    [1] Maddox, W., Garipov, T., Izmailov, P., Vetrov, D., Wilson, AG.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    [*A Simple Baseline for Bayesian Uncertainty in Deep Learning*](https://arxiv.org/abs/1902.02476).</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    NeurIPS 2019.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    model : torch.nn.Module</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    train_loader : torch.data.utils.DataLoader</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        training data loader to use for snapshot collection</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    criterion : torch.nn.CrossEntropyLoss or torch.nn.MSELoss</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        loss function to use for snapshot collection</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    n_snapshots_total : int</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        total number of model snapshots to collect</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    snapshot_freq : int</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        snapshot collection frequency (in epochs)</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    lr : float</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        SGD learning rate for collecting snapshots</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    momentum : float</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        SGD momentum</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    weight_decay : float</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        SGD weight decay</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    min_var : float</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        minimum parameter variance to clamp to (for numerical stability)</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    -------</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    param_variances : torch.Tensor</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        vector of marginal variances for each model parameter</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="c1"># create a copy of the model to avoid undesired changes to the original model parameters</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">_model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">_model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">_model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="c1"># initialize running estimates of first and second moment of model parameters</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="n">mean</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">_param_vector</span><span class="p">(</span><span class="n">_model</span><span class="p">))</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">sq_mean</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">_param_vector</span><span class="p">(</span><span class="n">_model</span><span class="p">))</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">n_snapshots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="c1"># run SGD to collect model snapshots</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="n">optimizer</span><span class="p">:</span> <span class="n">Optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">_model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="n">momentum</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="p">)</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="n">n_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">snapshot_freq</span> <span class="o">*</span> <span class="n">n_snapshots_total</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">):</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="k">for</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">train_loader</span><span class="p">:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">_model</span><span class="p">(</span><span class="n">inputs</span><span class="p">),</span> <span class="n">targets</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="n">snapshot_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="c1"># update running estimates of first and second moment of model parameters</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">old_fac</span><span class="p">,</span> <span class="n">new_fac</span> <span class="o">=</span> <span class="n">n_snapshots</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_snapshots</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_snapshots</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">*</span> <span class="n">old_fac</span> <span class="o">+</span> <span class="n">_param_vector</span><span class="p">(</span><span class="n">_model</span><span class="p">)</span> <span class="o">*</span> <span class="n">new_fac</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="n">sq_mean</span> <span class="o">=</span> <span class="n">sq_mean</span> <span class="o">*</span> <span class="n">old_fac</span> <span class="o">+</span> <span class="n">_param_vector</span><span class="p">(</span><span class="n">_model</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">new_fac</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">n_snapshots</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="c1"># compute marginal parameter variances, Var[P] = E[P^2] - E[P]^2</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">param_variances</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">sq_mean</span> <span class="o">-</span> <span class="n">mean</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_var</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">return</span> <span class="n">param_variances</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../marglik_training/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Marglik Training Utils">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Marglik Training Utils
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/aleximmer/laplace" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/laplace-torch/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.indexes", "navigation.tracking", "content.code.annotate", "toc.follow", "navigation.footer", "navigation.top", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>